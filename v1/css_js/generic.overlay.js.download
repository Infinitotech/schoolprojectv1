var indexArray=new Array();var urlArray=new Array();var currentIndex='';var currentKey;var preventDoubleClick=false;var currentScreenTop=0;var userNameArray=new Array();var scrollToArray=new Array();var deletedArray=new Array();var originalBodyBgColor='';var screenPosition='';$(document).ready(function(){$('a.trigger-generic-array').each(function(){var tmpKey=$(this).attr('data-index');indexArray[tmpKey]=$(this).attr('data-index');userNameArray[tmpKey]=$(this).html();if($(this).attr('href').indexOf("?")==-1){urlArray[tmpKey]=$(this).attr('href')+'?show_layover=1';}else{urlArray[tmpKey]=$(this).attr('href')+'&show_layover=1';}
scrollToArray[tmpKey]=$(this).offset().top;});$(document).on('click','a.trigger-generic-array',function(e){e.preventDefault();if(preventDoubleClick){return;}
preventDoubleClick=true;currentScreenTop=$(document).scrollTop();$('.generic-overlay').css('top',currentScreenTop-80);currentIndex=$(this).attr('data-index');currentKey=$.inArray(currentIndex,indexArray);if(currentKey==-1){alert('Error code: [AJAX results 1] Something went wrong. Please refresh this page to try again.');return;}
$.ajax({type:"GET",url:urlArray[currentKey],cache:false,async:true,beforeSend:function(x)
{$('.generic-overlay-content').html('<div class="col-span-4">&nbsp;</div><div class="col-span-4"><img src="'+webpath_img+'icon_loading_circle_results.gif" class="loadingGif results-loading-gif"/></div><div class="clear"></div>');$('.generic-overlay').show();},success:function(html)
{$('.generic-overlay-content').html(html);},error:function(){alert('Error code: [AJAX results 2] Something went wrong. Please refresh this page to try again.');},complete:function(){preventDoubleClick=false;}});});$(document).on('click','.close-generic-overlay',function(e){e.preventDefault();$('.generic-overlay').hide();$('html,body').animate({scrollTop:currentScreenTop},'slow');if($(this).hasClass('refreshThemesTrigger')){refreshThemes(urlArray);}
if($(this).hasClass('refreshAccessListTrigger')){refreshAccessLists(urlArray);}
if($(this).hasClass('refreshCertificateTrigger')){refreshCertificates(urlArray);}
if($(this).hasClass('refreshWebhooksTrigger')){refreshWebhooks(urlArray);}});$('a.trigger-results-array').each(function(){indexArray.push($(this).attr('data-index'));userNameArray.push($(this).html());urlArray.push($(this).attr('href')+'&show_layover=1');scrollToArray.push($(this).closest('div.row').offset().top);});$(document).on('click','a.trigger-results-array,a.trigger-results',function(e){e.preventDefault();if(preventDoubleClick){return;}
preventDoubleClick=true;$('a.trigger-results-array').css('text-decoration','underline');$('.overlay-bg-darken-trigger div.row').removeClass('highlight-user-row-on-layover');$(".overlay-bg-darken-trigger a[data-index='"+$(this).attr('data-index')+"']").closest('div.row').addClass('highlight-user-row-on-layover');if(currentIndex==$(this).attr('data-index')){if($('.result-overlay').css('display')!='none'){preventDoubleClick=false;return;}}
currentIndex=$(this).attr('data-index');currentKey=$.inArray(currentIndex,indexArray);if(currentKey==-1){alert('Error code: [AJAX results 1] Something went wrong. Please refresh this page to try again.');return;}
setNextUserLink();setPreviousUserLink();$.ajax({type:"GET",url:urlArray[currentKey],cache:false,async:true,beforeSend:function(x)
{$('#footer').hide();$('.overlay-bg-darken-trigger').addClass('darken-table-bg-on-layover');$('.result-overlay-navigation').hide();$('.result-overlay-content').html('<div class="col-span-4">&nbsp;</div><div class="col-span-4"><img src="'+webpath_img+'icon_loading_circle_results.gif" class="loadingGif results-loading-gif"/></div><div class="clear"></div>');$('html,body').animate({scrollTop:scrollToArray[currentKey]-40},'slow');$('.result-overlay').css('top',scrollToArray[currentKey]-180);$('.result-overlay').show();},success:function(html)
{$('.result-overlay-content').html(html);convertBBcodetoHtml();$('.result-overlay-navigation').show();$(".imgw").css("max-width",'600px').show();},error:function(){alert('Error code: [AJAX results 2] Something went wrong. Please refresh this page to try again.');},complete:function(){preventDoubleClick=false;}});});$(document).on('click','.close-result-overlay',function(e){e.preventDefault();closeOverlay();});$(document).on('click',"#delete_single_result",function(event){event.preventDefault();if(!confirm('WARNING: Deleting is permanent!')){return;}
$.ajax({type:"POST",url:"/a/results/delete/",data:$("#delete_single_result_form").serialize(),cache:false,dataType:'json',async:true,success:function(data)
{if(data.response=='success'){$('.result-overlay-content').html(data.msg);$('html,body').animate({scrollTop:$('.result-overlay').offset().top},'slow');$('a.trigger-results-array').each(function(){if($(this).attr('data-index')==currentIndex){$(this).closest('div.row').html('<div class="alert-box">'+userNameArray[currentKey]+': Result deleted.</div>');deletedArray.push(currentKey);closeOverlay();}});}else if(data.response=='error'){alert(data.msg);}else{alert('Error code: [AJAX Delete 1] Something went wrong. Please refresh this page to try again.');}},error:function(){alert('Error code: [AJAX Delete 2] Something went wrong. Please refresh this page to try again.');},complete:function(){preventDoubleClick=false;}});return false;});$(document).on('click','.setup-print-result-overlay',function(e){$('.result-overlay-navigation, .close-result-overlay').hide();var closePrintHtml='<div class="print-btns noprint"><a href="javascript:print();" class="btn btn-results">Print</a>&nbsp;&nbsp;&nbsp;<a href="#" class="close-print-result-overlay btn btn-create">Back</a></div>';originalBodyBgColor=$('body').css('background-color');screenPosition=$('.result-overlay').position();$('body').css('background-color','#fff');$('#content').after('<div id="print-content">'+$('.result-overlay').html()+'</div>');$('.header').hide();$('#content').hide();$('#footer').hide();$('#print-content').prepend('<div class="print-classmarker-header"><h4>&nbsp;</h4></div>');$('#print-content').prepend(closePrintHtml);});$(document).on('click','.close-print-result-overlay',function(e){$('body').css('background-color',originalBodyBgColor);$('#print-content').html('');$('.header').show();$('#content').show();$('#footer').show();$('.result-overlay-navigation, .close-result-overlay').show();$('html,body').animate({scrollTop:screenPosition.top},'slow');});});function refreshThemes(urlArray){$('#reloadThemesMsg').show();$('#theme_dropdown_holder').load(webpath_admin+'tests/themes/manage/updateTheme.rpc.php?refresh_theme_list=1',function(response,status,xhr){if(status=="error"){$("#reloadThemesMsg").html('Looks like something has gone wrong. Please refresh this page to start again.');}else{$('#reloadThemesMsg').hide();$('#theme').val($('input[name="theme_id"]').val());urlArray[$('#edit_theme_link').attr('data-index')]=webpath_admin+'tests/themes/manage/?theme_id='+$('#theme').val()+'&show_layover';if($('#theme').val()!=0){$('#edit_theme_link').show();}}});}
function refreshAccessLists(urlArray){$('#reloadAccessListsMsg').show();$('#access_list_dropdown_holder').load(webpath_admin+'users/accesslists/manage/updateAccessList.rpc.php?refresh_access_list=1',function(response,status,xhr){if(status=="error"){$("#reloadAccessListsMsg").html('Looks like something has gone wrong. Please refresh this page to start again.');}else{$('#reloadAccessListsMsg').hide();$('#access_list').val($('input[name="al_id"]').val());urlArray[$('#edit_access_list_link').attr('data-index')]=webpath_admin+'users/accesslists/manage/?al_id='+$('#access_list').val()+'&show_layover';if($('#access_list').val()!=0){$('#edit_access_list_link').show();}else{$('#edit_access_list_link').hide();}}});}
function refreshCertificates(urlArray){$('#reloadCertificatesMsg').show();$('#certificate_dropdown_holder').load(webpath_admin+'tests/certificates/manage/updateCertificate.rpc.php?refresh_certificate_list=1',function(response,status,xhr){if(status=="error"){$("#reloadCertificatesMsg").html('Looks like something has gone wrong. Please refresh this page to start again.');}else{$('#reloadCertificatesMsg').hide();$('#certificate').val($('input[name="certificate_id"]').val());urlArray[$('#edit_certificate_link').attr('data-index')]=webpath_admin+'tests/certificates/manage/?certificate_id='+$('#certificate').val()+'&show_layover';if($('#certificate').val()!=0){$('#edit_certificate_link').show();}else{$('#edit_certificate_link').hide();}}});}
function refreshWebhooks(urlArray){$('#reloadWebhooksMsg').show();$('#webhook_dropdown_holder').load(webpath_admin+'myaccount/webhooks/edit/updateWebhook.rpc.php?refresh_webhook_list=1',function(response,status,xhr){if(status=="error"){$("#reloadWebhooksMsg").html('Looks like something has gone wrong. Please refresh this page to start again.');}else{$('#reloadWebhooksMsg').hide();$('#webhook').val($('input[name="webhook_id"]').val());urlArray[$('#edit_webhook_link').attr('data-index')]=webpath_admin+'myaccount/webhooks/edit/?webhook_id='+$('#webhook').val()+'&show_layover';if($('#webhook').val()!=0){$('#edit_webhook_link').show();}else{$('#edit_webhook_link').hide();}}});}
function setNextUserLink(){var nextUserKey=currentKey+1;var checkDeleted=true;while(checkDeleted){if($.inArray(nextUserKey,deletedArray)!=-1){nextUserKey++;}else{checkDeleted=false;}}
if(indexArray[nextUserKey]!==undefined){$('.result-overlay-user-next').html('<a href="#" class="trigger-results next-result" data-index="'+indexArray[nextUserKey]+'">'+userNameArray[nextUserKey]+'&nbsp;&nbsp;&gt;&gt;</a>');}else{$('.result-overlay-user-next').html('&nbsp;');}}
function setPreviousUserLink(){var prevUserKey=currentKey-1;var checkDeleted=true;while(checkDeleted){if($.inArray(prevUserKey,deletedArray)!=-1){prevUserKey--;}else{checkDeleted=false;}}
if(indexArray[prevUserKey]!==undefined){$('.result-overlay-user-previous').html('<a href="#" class="trigger-results next-result" data-index="'+indexArray[prevUserKey]+'">&lt;&lt;&nbsp;&nbsp;'+userNameArray[prevUserKey]+'</a>');}else{$('.result-overlay-user-previous').html('&nbsp;');}}
function closeOverlay(){$('.overlay-bg-darken-trigger').removeClass('darken-table-bg-on-layover');$('.overlay-bg-darken-trigger div.row').removeClass('highlight-user-row-on-layover');$('.result-overlay').hide();$('#footer').show();}