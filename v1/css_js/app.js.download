$(window).bind("load",function(){window.App={Models:{},Collections:{},Views:{},Routers:{}};tests_json_to_array(get_tests_data_json_path);var json_tests=tests_json();var json_groups=groups_json();var json_links=links_json();var json_categories=categories_json();App.Models.Category=Backbone.Model.extend({});App.Collections.Categories=Backbone.Collection.extend({model:App.Models.Category});App.Views.Category=Backbone.View.extend({tagName:'select',id:'cat_select',initialize:function(){_.bindAll(this,'render');},render:function(){$(this.el).attr('name','cat_id').addClass('cats_in_qb_filter');var template=$("#categoryTemplate").html();var categories_select_template=_.template(template,{categories:this.collection.toJSON()});this.$el.html(categories_select_template);return this;}});App.Models.Test=Backbone.Model.extend({});App.Collections.Tests=Backbone.Collection.extend({model:App.Models.Test,comparator:function(a,b){var name_a=a.get('name').toUpperCase();var name_b=b.get('name').toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;},search:function(value){if(value=="")return this;return _(this.filter(function(data){var pattern=new RegExp(value,"gi");return pattern.test(data.get("name"));}));},sortGroups:function(test){test.get('groups').sort(function(a,b){var name_a=a.name.toUpperCase();var name_b=b.name.toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;});},sortLinks:function(test){test.get('links').sort(function(a,b){var name_a=a.name.toUpperCase();var name_b=b.name.toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;});},filterByCategoryId:function(id){return _(this.filter(function(data){if(id=='-1')return this;return data.get("cat_id")==id;}));}});App.Views.Test=Backbone.View.extend({tagName:'li',initialize:function(){_.bindAll(this,'render');this.model.bind('change',this.render);this.template=_.template($('#testTemplate').html());},events:{'click .test_container':'showGroups','click .open_embed_links':'showDirectLinkCode'},showGroups:function(event){if(!$(event.target).is("a")){this.$('.test_container').toggleClass('closed').toggleClass('open');this.$('.test_groups').slideToggle('fast').toggleClass('hide');}},showDirectLinkCode:function(event){event.preventDefault();this.$('#'+$(event.target).data('ext_test_id')).slideToggle('fast').toggleClass('hide');},render:function(){this.$el.html(this.template(this.model.toJSON()));return this;}});App.Views.TestsList=App.Views.Test.extend({});App.Views.Tests=Backbone.View.extend({tagName:'section',initialize:function(){_.bindAll(this,'render');this.template=_.template($('#testBaseTemplate').html());this.templateEmpty=_.template($('#testEmptyTemplate').html());this.collection.bind('reset',this.render);},events:{'click .expandAll':'showTests','click .collapseAll':'hideTests','change #cat_select':'filterByCategoryId','keyup #test_search':'search'},showTests:function(event){event.preventDefault();this.$('.test_container').removeClass('closed').addClass('open');this.$('.test_groups').show().removeClass('hide');},hideTests:function(event){event.preventDefault();this.$('.test_container').removeClass('open').addClass('closed');this.$('.test_groups').hide().addClass('hide');},filterByCategoryId:function(event){var category_id=this.$('#cat_select').val();this.renderList(this.collection.filterByCategoryId(category_id));},search:function(event){var search_value=$("#test_search").val();this.renderList(this.collection.search(search_value));},renderList:function(tests){$(".table-body").html("");tests.each(function(test){var view=new App.Views.TestsList({model:test,collection:this.collection});$(".table-body").append(view.render().el);});$('.table-body').show();return this;},render:function(){var tests,collection=this.collection,categories=this.options.categories;this.$el.html(this.template({}));tests=this.$('.table-body');if(collection.length>0){if(collection.length<10){this.$('div.hide_if_no_data_bottom').html('&nbsp;');}
var categoriesView=new App.Views.Category({collection:categories});this.$('#cat_filter').after(categoriesView.render().el);collection.each(function(test){collection.sortGroups(test);collection.sortLinks(test);var view=new App.Views.TestsList({model:test,collection:collection});tests.append(view.render().el);});}
else{this.$('div.hide_if_no_data, span.hide_if_no_data').html('&nbsp;');this.$('div.hide_if_no_data_bottom, span.hide_if_no_data').html('&nbsp;');tests.append(this.templateEmpty({}));}
return this;}});App.Models.Group=Backbone.Model.extend({});App.Collections.Groups=Backbone.Collection.extend({model:App.Models.Group,comparator:function(a,b){var name_a=a.get('name').toUpperCase();var name_b=b.get('name').toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;},search:function(value){if(value=="")return this;return _(this.filter(function(data){var pattern=new RegExp(value,"gi");return pattern.test(data.get("name"));}));},sortTests:function(group){group.get('tests').sort(function(a,b){var name_a=a.name.toUpperCase();var name_b=b.name.toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;});}});App.Views.Group=Backbone.View.extend({tagName:'li',initialize:function(){_.bindAll(this,'render');this.model.bind('change',this.render);this.template=_.template($('#groupTemplate').html());},events:{'click .group_container':'showGroups'},showGroups:function(event){if(!$(event.target).is("a")){this.$('.group_container').toggleClass('closed').toggleClass('open');this.$('.group_tests').slideToggle('fast').toggleClass('hide');}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this;}});App.Views.GroupsList=App.Views.Group.extend({});App.Views.Groups=Backbone.View.extend({tagName:'section',initialize:function(){_.bindAll(this,'render');this.template=_.template($('#groupsBaseTemplate').html());this.templateEmpty=_.template($('#groupEmptyTemplate').html());this.collection.bind('reset',this.render);},events:{'click .expandAll':'showGroups','click .collapseAll':'hideGroups','keyup #group_search':'search'},showGroups:function(event){event.preventDefault();this.$('.group_container').removeClass('closed').addClass('open');this.$('.group_tests').show().removeClass('hide');},hideGroups:function(event){event.preventDefault();this.$('.group_container').removeClass('open').addClass('closed');this.$('.group_tests').hide().addClass('hide');},renderList:function(groups){$(".table-body").html("");groups.each(function(group){var view=new App.Views.GroupsList({model:group,collection:this.collection});$(".table-body").append(view.render().el);});$('.table-body').show();return this;},render:function(){var $groups,collection=this.collection;this.$el.html(this.template({}));$groups=this.$('.table-body');if(collection.length>0){if(collection.length<10){this.$('div.hide_if_no_data_bottom').html('&nbsp;');}
collection.each(function(group){collection.sortTests(group);var view=new App.Views.GroupsList({model:group,collection:collection});$groups.append(view.render().el);});}
else{this.$('div.hide_if_no_data, span.hide_if_no_data').html('&nbsp;');this.$('div.hide_if_no_data_bottom, span.hide_if_no_data').html('&nbsp;');$groups.append(this.templateEmpty({}));}
return this;},search:function(event){var search_value=$("#group_search").val();this.renderList(this.collection.search(search_value));}});App.Models.Link=Backbone.Model.extend({});App.Collections.Links=Backbone.Collection.extend({model:App.Models.Link,comparator:function(a,b){var name_a=a.get('name').toUpperCase();var name_b=b.get('name').toUpperCase();return(name_a<name_b)?-1:(name_a>name_b)?1:0;},search:function(value){if(value=="")return this;return _(this.filter(function(data){var pattern=new RegExp(value,"gi");return pattern.test(data.get("name"));}));}});App.Views.Link=Backbone.View.extend({tagName:'li',initialize:function(){_.bindAll(this,'render');this.model.bind('change',this.render);this.template=_.template($('#linkTemplate').html());},events:{'click .link_container':'showLinks','click .ex_link':'showDirectLinkCode'},showLinks:function(event){if(!$(event.target).is("a")){this.$('.link_container').toggleClass('closed').toggleClass('open');this.$('.link_tests').slideToggle('fast').toggleClass('hide');}},showDirectLinkCode:function(event){event.preventDefault();this.$('.linksinafold').slideToggle('fast').toggleClass('hide');},render:function(){this.$el.html(this.template(this.model.toJSON()));return this;}});App.Views.LinksList=App.Views.Link.extend({});App.Views.Links=Backbone.View.extend({tagName:'section',initialize:function(){_.bindAll(this,'render');this.template=_.template($('#linksBaseTemplate').html());this.templateEmpty=_.template($('#linkEmptyTemplate').html());this.collection.bind('reset',this.render);},events:{'click .expandAll':'showLinks','click .collapseAll':'hideLinks','keyup #link_search':'search'},showLinks:function(event){event.preventDefault();this.$('.link_container').removeClass('closed').addClass('open');this.$('.link_tests').show().removeClass('hide');},hideLinks:function(event){event.preventDefault();this.$('.link_container').removeClass('open').addClass('closed');this.$('.link_tests').hide().addClass('hide');},renderList:function(links){$(".table-body").html("");links.each(function(link){var view=new App.Views.LinksList({model:link,collection:this.collection});$(".table-body").append(view.render().el);});$('.table-body').show();return this;},render:function(){var $links,collection=this.collection;this.$el.html(this.template({}));$links=this.$('.table-body');if(collection.length>0){if(collection.length<10){this.$('div.hide_if_no_data_bottom').html('&nbsp;');}
collection.each(function(link){var view=new App.Views.LinksList({model:link,collection:collection});$links.append(view.render().el);});}
else{this.$('div.hide_if_no_data, span.hide_if_no_data').html('&nbsp;');this.$('div.hide_if_no_data_bottom, span.hide_if_no_data').html('&nbsp;');$links.append(this.templateEmpty({}));}
return this;},search:function(event){var search_value=$("#link_search").val();this.renderList(this.collection.search(search_value));}});App.Routers.Tests=Backbone.Router.extend({routes:{'':'tests','tests':'tests','tests/':'tests','tests/:name':'testsFilter','groups':'groups','groups/':'groups','groups/:name':'groupsFilter','links':'links','links/':'links','links/:name':'linksFilter'},initialize:function(){window.tests=new App.Collections.Tests(json_tests);window.categories=new App.Collections.Categories(json_categories);window.groups=new App.Collections.Groups(json_groups);window.links=new App.Collections.Links(json_links);},start:function(){Backbone.history.start();},tests:function(){this.testsView=new App.Views.Tests({collection:window.tests,categories:window.categories});$('#content').empty();$('#content').append(this.testsView.render().el);},testsFilter:function(name){this.testsView=new App.Views.Tests({collection:window.tests,categories:window.categories});$('#content').empty();$('#content').append(this.testsView.render().el);$('#content #test_search').val(name);this.testsView.search();},groups:function(){this.groupsView=new App.Views.Groups({collection:window.groups});$('#content').empty();$('#content').append(this.groupsView.render().el);},groupsFilter:function(name){this.groupsView=new App.Views.Groups({collection:window.groups});$('#content').empty();$('#content').append(this.groupsView.render().el);$('#content #group_search').val(name);this.groupsView.search();},links:function(){this.linksView=new App.Views.Links({collection:window.links});$('#content').empty();$('#content').append(this.linksView.render().el);},linksFilter:function(name){this.linksView=new App.Views.Links({collection:window.links});$('#content').empty();$('#content').append(this.linksView.render().el);$('#content #link_search').val(name);this.linksView.search();}});$(function(){window.Workspace=new App.Routers.Tests();window.Workspace.start();});});