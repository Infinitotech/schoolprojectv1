(function($){function maybeCall(thing,ctx){return(typeof thing=='function')?(thing.call(ctx)):thing;};function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle();};Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+ pos.height+ this.options.offset,left:pos.left+ pos.width/2- actualWidth/2};break;case's':tp={top:pos.top- actualHeight- this.options.offset,left:pos.left+ pos.width/2- actualWidth/2};break;case'e':tp={top:pos.top+ pos.height/2- actualHeight/2,left:pos.left- actualWidth- this.options.offset};break;case'w':tp={top:pos.top+ pos.height/2- actualHeight/2,left:pos.left+ pos.width+ this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+ pos.width/2- 15;}else{tp.left=pos.left+ pos.width/2- actualWidth+ 15;}}
$tip.css(tp).addClass('tipsy-'+ gravity);$tip.find('.tipsy-arrow')[0].className='tipsy-arrow tipsy-arrow-'+ gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]));}
if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof($e.attr('original-title'))!='string'){$e.attr('original-title',$e.attr('title')||'').removeAttr('title');}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+ title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){var tipsy=this.data('tipsy');if(tipsy)tipsy[options]();return this;}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';if(options.live)
$(document).on(eventIn,this.selector,enter).on(eventOut,this.selector,leave);else
this.bind(eventIn,enter).bind(eventOut,leave);}
return this;};$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:0,fallback:'',gravity:'n',html:false,live:true,offset:0,opacity:1,title:'title',trigger:'hover'};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+ $(window).height()/ 2) ? 's' : 'n';
};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+ $(window).width()/ 2) ? 'e' : 'w';
};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:(prefer.length>1?prefer[1]:false)},boundTop=$(document).scrollTop()+ margin,boundLeft=$(document).scrollLeft()+ margin,$this=$(this);if($this.offset().top<boundTop)dir.ns='n';if($this.offset().left<boundLeft)dir.ew='w';if($(window).width()+ $(document).scrollLeft()- $this.offset().left<margin)dir.ew='e';if($(window).height()+ $(document).scrollTop()- $this.offset().top<margin)dir.ns='s';return dir.ns+(dir.ew?dir.ew:'');}};})(jQuery);(function(factory){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory((typeof(jQuery)!='undefined')?jQuery:window.Zepto);}}
(function($){"use strict";var feature={};feature.fileapi=$("<input type='file'/>").get(0).files!==undefined;feature.formdata=window.FormData!==undefined;var hasProp=!!$.fn.prop;$.fn.attr2=function(){if(!hasProp){return this.attr.apply(this,arguments);}
var val=this.prop.apply(this,arguments);if((val&&val.jquery)||typeof val==='string'){return val;}
return this.attr.apply(this,arguments);};$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}
var method,action,url,$form=this;if(typeof options=='function'){options={success:options};}
else if(options===undefined){options={};}
method=options.type||this.attr2('method');action=options.url||this.attr2('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1];}
options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||$.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}
if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}
var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional;}
var elements=[];var qx,a=this.formToArray(options.semantic,elements);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional);}
if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}
this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}
var q=$.param(a,traditional);if(qx){q=(q?(q+'&'+ qx):qx);}
if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+ q;options.data=null;}
else{options.data=q;}
var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}
if(options.clearForm){callbacks.push(function(){$form.clearForm(options.includeHidden);});}
if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}
else if(options.success){callbacks.push(options.success);}
options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};if(options.error){var oldError=options.error;options.error=function(xhr,status,error){var context=options.context||this;oldError.apply(context,[xhr,status,error,$form]);};}
if(options.complete){var oldComplete=options.complete;options.complete=function(xhr,status){var context=options.context||this;oldComplete.apply(context,[xhr,status,$form]);};}
var fileInputs=$('input[type=file]:enabled',this).filter(function(){return $(this).val()!=='';});var hasFileInputs=fileInputs.length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+ fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a);});}
else{jqxhr=fileUploadIframe(a);}}
else if((hasFileInputs||multipart)&&fileAPI){jqxhr=fileUploadXhr(a);}
else{jqxhr=$.ajax(options);}
$form.removeData('jqxhr').data('jqxhr',jqxhr);for(var k=0;k<elements.length;k++){elements[k]=null;}
this.trigger('form-submit-notify',[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData,options.traditional).split('&');var len=serialized.length;var result=[];var i,part;for(i=0;i<len;i++){serialized[i]=serialized[i].replace(/\+/g,' ');part=serialized[i].split('=');result.push([decodeURIComponent(part[0]),decodeURIComponent(part[1])]);}
return result;}
function fileUploadXhr(a){var formdata=new FormData();for(var i=0;i<a.length;i++){formdata.append(a[i].name,a[i].value);}
if(options.extraData){var serializedData=deepSerialize(options.extraData);for(i=0;i<serializedData.length;i++){if(serializedData[i]){formdata.append(serializedData[i][0],serializedData[i][1]);}}}
options.data=null;var s=$.extend(true,{},$.ajaxSettings,options,{contentType:false,processData:false,cache:false,type:method||'POST'});if(options.uploadProgress){s.xhr=function(){var xhr=$.ajaxSettings.xhr();if(xhr.upload){xhr.upload.addEventListener('progress',function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable){percent=Math.ceil(position/total*100);}
options.uploadProgress(event,position,total,percent);},false);}
return xhr;};}
s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,o){if(options.formData){o.data=options.formData;}
else{o.data=formdata;}
if(beforeSend){beforeSend.call(this,xhr,o);}};return $.ajax(s);}
function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var deferred=$.Deferred();deferred.abort=function(status){xhr.abort(status);};if(a){for(i=0;i<elements.length;i++){el=$(elements[i]);if(hasProp){el.prop('disabled',false);}
else{el.removeAttr('disabled');}}}
s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr2('name');if(!n){$io.attr2('name',id);}
else{id=n;}}
else{$io=$('<iframe name="'+ id+'" src="'+ s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'});}
io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+ e);this.aborted=1;try{if(io.contentWindow.document.execCommand){io.contentWindow.document.execCommand('Stop');}}
catch(ignore){}
$io.attr('src',s.iframeSrc);xhr.error=e;if(s.error){s.error.call(s.context,xhr,e,status);}
if(g){$.event.trigger("ajaxError",[xhr,s,e]);}
if(s.complete){s.complete.call(s.context,xhr,e);}}};g=s.global;if(g&&0===$.active++){$.event.trigger("ajaxStart");}
if(g){$.event.trigger("ajaxSend",[xhr,s]);}
if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}
deferred.reject();return deferred;}
if(xhr.aborted){deferred.reject();return deferred;}
sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y;}}}
var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=null;try{if(frame.contentWindow){doc=frame.contentWindow.document;}}catch(err){log('cannot get iframe.contentWindow document: '+ err);}
if(doc){return doc;}
try{doc=frame.contentDocument?frame.contentDocument:frame.document;}catch(err){log('cannot get iframe.contentDocument: '+ err);doc=frame.document;}
return doc;}
var csrf_token=$('meta[name=csrf-token]').attr('content');var csrf_param=$('meta[name=csrf-param]').attr('content');if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token;}
function doSubmit(){var t=$form.attr2('target'),a=$form.attr2('action'),mp='multipart/form-data',et=$form.attr('enctype')||$form.attr('encoding')||mp;form.setAttribute('target',id);if(!method||/post/i.test(method)){form.setAttribute('method','POST');}
if(a!=s.url){form.setAttribute('action',s.url);}
if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}
if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT);},s.timeout);}
function checkState(){try{var state=getDoc(io).readyState;log('state = '+ state);if(state&&state.toLowerCase()=='uninitialized'){setTimeout(checkState,50);}}
catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);if(timeoutHandle){clearTimeout(timeoutHandle);}
timeoutHandle=undefined;}}
var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){if(s.extraData.hasOwnProperty(n)){if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty('name')&&s.extraData[n].hasOwnProperty('value')){extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').val(s.extraData[n].value).appendTo(form)[0]);}else{extraInputs.push($('<input type="hidden" name="'+n+'">').val(s.extraData[n]).appendTo(form)[0]);}}}}
if(!s.iframeTarget){$io.appendTo('body');}
if(io.attachEvent){io.attachEvent('onload',cb);}
else{io.addEventListener('load',cb,false);}
setTimeout(checkState,15);try{form.submit();}catch(err){var submitFn=document.createElement('form').submit;submitFn.apply(form);}}
finally{form.setAttribute('action',a);form.setAttribute('enctype',et);if(t){form.setAttribute('target',t);}else{$form.removeAttr('target');}
$(extraInputs).remove();}}
if(s.forceSync){doSubmit();}
else{setTimeout(doSubmit,10);}
var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return;}
doc=getDoc(io);if(!doc){log('cannot access response document');e=SERVER_ABORT;}
if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');deferred.reject(xhr,'timeout');return;}
else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');deferred.reject(xhr,'error','server abort');return;}
if(!doc||doc.location.href==s.iframeSrc){if(!timedOut){return;}}
if(io.detachEvent){io.detachEvent('onload',cb);}
else{io.removeEventListener('load',cb,false);}
var status='success',errMsg;try{if(timedOut){throw'timeout';}
var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML)){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}}
var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml){s.dataType='xml';}
xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header.toLowerCase()];};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText;}
var dt=(s.dataType||'').toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText;}
else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText;}
else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText;}}}
else if(dt=='xml'&&!xhr.responseXML&&xhr.responseText){xhr.responseXML=toXml(xhr.responseText);}
try{data=httpData(xhr,dt,s);}
catch(err){status='parsererror';xhr.error=errMsg=(err||status);}}
catch(err){log('error caught: ',err);status='error';xhr.error=errMsg=(err||status);}
if(xhr.aborted){log('upload aborted');status=null;}
if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error';}
if(status==='success'){if(s.success){s.success.call(s.context,data,'success',xhr);}
deferred.resolve(xhr.responseText,'success',xhr);if(g){$.event.trigger("ajaxSuccess",[xhr,s]);}}
else if(status){if(errMsg===undefined){errMsg=xhr.statusText;}
if(s.error){s.error.call(s.context,xhr,status,errMsg);}
deferred.reject(xhr,'error',errMsg);if(g){$.event.trigger("ajaxError",[xhr,s,errMsg]);}}
if(g){$.event.trigger("ajaxComplete",[xhr,s]);}
if(g&&!--$.active){$.event.trigger("ajaxStop");}
if(s.complete){s.complete.call(s.context,xhr,status);}
callbackProcessed=true;if(s.timeout){clearTimeout(timeoutHandle);}
setTimeout(function(){if(!s.iframeTarget){$io.remove();}
else{$io.attr('src',s.iframeSrc);}
xhr.responseXML=null;},100);}
var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}
else{doc=(new DOMParser()).parseFromString(s,'text/xml');}
return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null;};var parseJSON=$.parseJSON||function(s){return window['eval']('('+ s+')');};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){if($.error){$.error('parsererror');}}
if(s&&s.dataFilter){data=s.dataFilter(data,type);}
if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data);}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}
return data;};return deferred;}};$.fn.ajaxForm=function(options){options=options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options);});return this;}
log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}
if(options.delegation){$(document).off('submit.form-plugin',this.selector,doAjaxSubmit).off('click.form-plugin',this.selector,captureSubmittingElement).on('submit.form-plugin',this.selector,options,doAjaxSubmit).on('click.form-plugin',this.selector,options,captureSubmittingElement);return this;}
return this.ajaxFormUnbind().bind('submit.form-plugin',options,doAjaxSubmit).bind('click.form-plugin',options,captureSubmittingElement);};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(e.target).ajaxSubmit(options);}}
function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!($el.is("[type=submit],[type=image]"))){var t=$el.closest('[type=submit]');if(t.length===0){return;}
target=t[0];}
var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!==undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX- offset.left;form.clk_y=e.pageY- offset.top;}else{form.clk_x=e.pageX- target.offsetLeft;form.clk_y=e.pageY- target.offsetTop;}}
setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);}
$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic,elements){var a=[];if(this.length===0){return a;}
var form=this[0];var formId=this.attr('id');var els=semantic?form.getElementsByTagName('*'):form.elements;var els2;if(els&&!/MSIE [678]/.test(navigator.userAgent)){els=$(els).get();}
if(formId){els2=$(':input[form="'+ formId+'"]').get();if(els2.length){els=(els||[]).concat(els2);}}
if(!els||!els.length){return a;}
var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n||el.disabled){continue;}
if(semantic&&form.clk&&el.type=="image"){if(form.clk==el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}
continue;}
v=$.fieldValue(el,true);if(v&&v.constructor==Array){if(elements){elements.push(el);}
for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}
else if(feature.fileapi&&el.type=='file'){if(elements){elements.push(el);}
var files=el.files;if(files.length){for(j=0;j<files.length;j++){a.push({name:n,value:files[j],type:el.type});}}
else{a.push({name:n,value:'',type:el.type});}}
else if(v!==null&&typeof v!='undefined'){if(elements){elements.push(el);}
a.push({name:n,value:v,type:el.type,required:el.required});}}
if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}
return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}
var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}
else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v});}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue;}
if(v.constructor==Array){$.merge(val,v);}
else{val.push(v);}}
return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}
if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null;}
if(tag=='select'){var index=el.selectedIndex;if(index<0){return null;}
var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes.value&&!(op.attributes.value.specified))?op.text:op.value;}
if(one){return v;}
a.push(v);}}
return a;}
return $(el).val();};$.fn.clearForm=function(includeHidden){return this.each(function(){$('input,select,textarea',this).clearFields(includeHidden);});};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value='';}
else if(t=='checkbox'||t=='radio'){this.checked=false;}
else if(tag=='select'){this.selectedIndex=-1;}
else if(t=="file"){if(/MSIE/.test(navigator.userAgent)){$(this).replaceWith($(this).clone(true));}else{$(this).val('');}}
else if(includeHidden){if((includeHidden===true&&/hidden/.test(t))||(typeof includeHidden=='string'&&$(this).is(includeHidden))){this.value='';}}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}
return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}
return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select;}
else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}
this.selected=select;}});};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug){return;}
var msg='[jquery.form] '+ Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg);}
else if(window.opera&&window.opera.postError){window.opera.postError(msg);}}}));jQuery.fn.countdown=function(options,total_time_limit,timestamp_to_finish){if(!options)options='()';if(jQuery(this).length==0)return false;var obj=this;var current_timestamp=Math.round(new Date().getTime()/ 1000);//CMMOD
if(options.seconds<0||options.seconds=='undefined')
{if(options.callback)eval(options.callback);return null;}
if(current_timestamp>timestamp_to_finish){if(options.callback)eval(options.callback);return null;}
actual_seconds_left=timestamp_to_finish- current_timestamp;if(actual_seconds_left<options.seconds){options.seconds=actual_seconds_left;}
window.setTimeout(function(){time_percentage_left=Math.floor((100/total_time_limit)*options.seconds);time_percentage_left=100- time_percentage_left;hrs=Math.floor(options.seconds/3600);mins_prep=options.seconds-(hrs*3600);mins=Math.floor(mins_prep/60);secs=mins_prep-(mins*60);if(mins<10){mins='0'+mins;}
if(secs<10){secs='0'+secs;}
display_time=hrs+':'+mins+':'+secs;jQuery(obj).html(String(display_time));$('div.show_timer').fadeIn();$('div.timeleft').attr('style','width:'+time_percentage_left+'%;');--options.seconds;jQuery(obj).countdown(options,total_time_limit,timestamp_to_finish);},1000);return this;}
jQuery.fn.countdown.stop=function(){window.clearTimeout(setTimeout("0")-1);};$("document").ready(function(){$.fn.jqm=function(o){var p={overlay:70,overlayClass:'jqmOverlay',closeClass:'jqmClose',trigger:'.jqModal',ajax:F,ajaxText:'',target:F,modal:F,toTop:F,onShow:F,onHide:F,onLoad:F};return this.each(function(){if(this._jqm)return H[this._jqm].c=$.extend({},H[this._jqm].c,o);s++;this._jqm=s;H[s]={c:$.extend(p,$.jqm.params,o),a:F,w:$(this).addClass('jqmID'+s),s:s};if(p.trigger)$(this).jqmAddTrigger(p.trigger);});};$.fn.jqmAddClose=function(e){return hs(this,e,'jqmHide');};$.fn.jqmAddTrigger=function(e){return hs(this,e,'jqmShow');};$.fn.jqmShow=function(t){return this.each(function(){t=t||window.event;$.jqm.open(this._jqm,t);});};$.fn.jqmHide=function(t){return this.each(function(){t=t||window.event;$.jqm.close(this._jqm,t);$('#fileSelectorDiv').html('');$('.clearHtml').html('');});};$.jqm={hash:{},open:function(s,t){var h=H[s],c=h.c,cc='.'+c.closeClass,z=(parseInt(h.w.css('z-index'))),z=(z>0)?z:3000,o=$('<div></div>').css({height:'100%',width:'100%',position:'fixed',left:0,top:0,'z-index':z-1,opacity:c.overlay/170});if(h.a)return F;h.t=t;h.a=true;h.w.css('z-index',z);if(c.modal){if(!A[0])L('bind');A.push(s);}
else if(c.overlay>0)h.w.jqmAddClose(o);else o=F;h.o=(o)?o.addClass(c.overlayClass).prependTo('body'):F;if(ie6){$('html,body').css({height:'100%',width:'100%'});if(o){o=o.css({position:'absolute'})[0];for(var y in{Top:1,Left:1})o.style.setExpression(y.toLowerCase(),"(_=(document.documentElement.scroll"+y+" || document.body.scroll"+y+"))+'px'");}}
if(c.ajax){var r=c.target||h.w,u=c.ajax,r=(typeof r=='string')?$(r,h.w):$(r),u=(u.substr(0,1)=='@')?$(t).attr(u.substring(1)):u;r.html(c.ajaxText).load(u,function(){if(c.onLoad)c.onLoad.call(this,h);if(cc)h.w.jqmAddClose($(cc,h.w));e(h);});}
else if(cc)h.w.jqmAddClose($(cc,h.w));if(c.toTop&&h.o)h.w.before('<span id="jqmP'+h.w[0]._jqm+'"></span>').insertAfter(h.o);(c.onShow)?c.onShow(h):h.w.show();e(h);return F;},close:function(s){var h=H[s];if(!h.a)return F;h.a=F;if(A[0]){A.pop();if(!A[0])L('unbind');}
if(h.c.toTop&&h.o)$('#jqmP'+h.w[0]._jqm).after(h.w).remove();if(h.c.onHide)h.c.onHide(h);else{h.w.hide();if(h.o)h.o.remove();}return F;},params:{}};var s=0,H=$.jqm.hash,A=[],ie6=msieversion(6),F=false,i=$('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),e=function(h){if(ie6)if(h.o)h.o.html('<p style="width:100%;height:100%"/>').prepend(i);else if(!$('iframe.jqm',h.w)[0])h.w.prepend(i);f(h);},f=function(h){try{$(':input:visible',h.w)[0].focus();}catch(_){}},L=function(t){$()[t]("keypress",m)[t]("keydown",m)[t]("mousedown",m);},m=function(e){var h=H[A[A.length-1]],r=(!$(e.target).parents('.jqmID'+h.s)[0]);if(r)f(h);return!r;},hs=function(w,t,c){return w.each(function(){var s=this._jqm;$(t).each(function(){if(!this[c]){this[c]=[];$(this).click(function(){for(var i in{jqmShow:1,jqmHide:1})for(var s in this[i])if(H[this[i][s]])H[this[i][s]].w[i](this);return F;});}this[c].push(s);});});};});function msieversion(asking_version){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");if(msie>0){var version=parseInt(ua.substring(msie+5,ua.indexOf(".",msie)));if(version==asking_version){return 1;}else{return 0;}}else{return 0;}}
(function(a){a.fn.extend({customSelect:function(c){if(typeof document.body.style.maxHeight==="undefined"){return this}var e={customClass:"customSelect",mapClass:true,mapStyle:true},c=a.extend(e,c),d=c.customClass,f=function(h,k){var g=h.find(":selected"),j=k.children(":first"),i=g.html()||"&nbsp;";j.html(i);if(g.attr("disabled")){k.addClass(b("DisabledOption"))}else{k.removeClass(b("DisabledOption"))}setTimeout(function(){k.removeClass(b("Open"));a(document).off("mouseup."+b("Open"))},60)},b=function(g){return d+g};return this.each(function(){var g=a(this),i=a("<span />").addClass(b("Inner")),h=a("<span />");g.after(h.append(i));h.addClass(d);if(c.mapClass){h.addClass(g.attr("class"))}if(c.mapStyle){h.attr("style",g.attr("style"))}g.addClass("hasCustomSelect").on("update",function(){f(g,h);var k=parseInt(g.outerWidth(),10)-(parseInt(h.outerWidth(),10)-parseInt(h.width(),10));h.css({display:"inline-block"});var j=h.outerHeight();if(g.attr("disabled")){h.addClass(b("Disabled"))}else{h.removeClass(b("Disabled"))}i.css({width:k,display:"inline-block"});g.css({"-webkit-appearance":"menulist-button",width:h.outerWidth(),position:"absolute",opacity:0,height:j,fontSize:h.css("font-size")})}).on("change",function(){h.addClass(b("Changed"));f(g,h)}).on("keyup",function(j){if(!h.hasClass(b("Open"))){g.blur();g.focus()}else{if(j.which==13||j.which==27){f(g,h)}}}).on("mousedown",function(j){h.removeClass(b("Changed"))}).on("mouseup",function(j){if(!h.hasClass(b("Open"))){if(a("."+b("Open")).not(h).length>0&&typeof InstallTrigger!=="undefined"){g.focus()}else{h.addClass(b("Open"));j.stopPropagation();a(document).one("mouseup."+b("Open"),function(k){if(k.target!=g.get(0)&&a.inArray(k.target,g.find("*").get())<0){g.blur()}else{f(g,h)}})}}}).focus(function(){h.removeClass(b("Changed")).addClass(b("Focus"))}).blur(function(){h.removeClass(b("Focus")+" "+b("Open"))}).hover(function(){h.addClass(b("Hover"))},function(){h.removeClass(b("Hover"))}).trigger("update")})}})})(jQuery);$("document").ready(function(){if(typeof(use_test_page_ajax)=="undefined"){use_test_page_ajax=false;}
$(document).on('click','[id^="tog_"]',function(e){e.preventDefault();$('#do'+ this.id).slideToggle();if($(this).hasClass('hideme')){$(this).hide();}});$(document).on('click','[id^="toggroup_"]',function(e){e.preventDefault();var group_identifier=this.id.substr(0,11);if($('#do'+ this.id).is(':visible')){$('#do'+ this.id).slideUp();return false;}
$('[id^="do'+group_identifier+'"]').each(function(){$(this).hide();});if($('#do'+ this.id).is(':visible')){$('#do'+ this.id).slideUp();}else{$('#do'+ this.id).slideDown();}});$('[id^="otog_"]').click(function(){$('#do'+ this.id.substring(1)).slideDown();});$('[id^="htog_"]').mouseenter(function(){$('#do'+ this.id).slideDown();return false;}).click(function(){$('#do'+ this.id).slideToggle();return false;});$('[id^="assigntog_"]').mouseenter(function(){$('[id^="doassigntog_"]').hide();$('#do'+ this.id).show();});$('[id^="showtog_rg"]').click(function(e){e.preventDefault();$('[id^="do'+this.id.substring(4)+'"]').slideDown();});$('[id^="hidetog_rg"]').click(function(e){e.preventDefault();$('[id^="do'+this.id.substring(4)+'"]').slideUp();});$('[id^="showtog_nrg"]').click(function(e){e.preventDefault();$('[id^="do'+this.id.substring(4)+'"]').slideDown();});$('[id^="hidetog_nrg"]').click(function(e){e.preventDefault();$('[id^="do'+this.id.substring(4)+'"]').slideUp();});$('#togleft').click(function(e){e.preventDefault();$('#dotogright').hide();$('#dotogleft').slideToggle();});$('#togright').click(function(e){e.preventDefault();$('#dotogleft').hide();$('#dotogright').slideToggle();});$('.showLoading').click(function(){$(this).after(' <img src="'+webpath_img+'icon_loading_circleV3.gif" class="loadingGif"/>');if($(this).hasClass('hidemeAdmin')){$(this).hide();}else{$('.loadingGif').delay(10000).fadeOut('slow');}});$(document).on('click','[class*="no_anchor"]',function(e){e.preventDefault();});$(document).on('click','[class^="anchor_scroll_"]',function(e){e.preventDefault();var class_array=$(this).attr('class').split(" ");var this_scroll_class=class_array[0].substring(7);if($(this).hasClass('open_anchor_element')){$('.'+this_scroll_class).show();}else{$('.'+this_scroll_class).removeClass('closed').addClass('open').next().show();}
$('html,body').animate({scrollTop:$('.'+this_scroll_class).offset().top},'slow');});$(document).on('click',".closeMeLink",function(e){e.preventDefault();$(this).closest('.closeMeContainer').slideUp();});$('.close-me').click(function(){$(this).closest('[class*="div-close-me"]').slideUp();return false;});$(".accordion-toggle").addClass('closed');$(".accordion-toggle").click(function(){var clickedID=this.id
if($(this).hasClass('closed')){$(this).removeClass('closed').addClass('open').next().show();}else{$(this).next().hide();$(this).removeClass('open').addClass('closed');}});$(".accordion-toggle a").click(function(e){e.stopPropagation();});function hideAllQuizNavigationButtons(){if(!use_test_page_ajax){window.onbeforeunload=null;}
var kit_pos_left=($('#questions_container').width()/ 2) -80 + $('#questions_container').offset().left;//80 is loading gif width // must use offset for left
if($(window).height()<$('.classmarker_content').height()){var kit_pos_top=$(window).height()/2;
}else{var kit_pos_top=$('.classmarker_content').height()/2+$('.classmarker_content').position().top;// must use position for top
}
$('img#icon_loading_kit').css('top',(kit_pos_top)).css('left',kit_pos_left).fadeIn(2000);startTimeoutLoadingError();$('#quiz_timer_container, #questions_container, .nextprev, #prev_questions, #display_q_links').animate({opacity:0},400,0);}
var counter=0;var can_click_quiz_button=true;$(document).on('click','a#qnext, a#qprev, a#qfinish_confirm, a#qsave_confirm, a#feedback_prev, a#feedback_next, a[id^="qjump_"]',function(){if((!use_test_page_ajax)&&(($(this).attr('id')=='feedback_prev')||($(this).attr('id')=='feedback_next')||$(this).attr('id').search(/qjump_/i)===0)){return true;}
if(can_click_quiz_button==true){can_click_quiz_button=false;hideAllQuizNavigationButtons();if($(this).attr('id')=='qnext'){$('#control').attr('name','next');}else if($(this).attr('id')=='qprev'){$('#control').attr('name','prev');}else if($(this).attr('id')=='qfinish_confirm'){if($(this).hasClass('feedback_finish')){$('#control').attr('name','feedback_finish');}else{$('#control').attr('name','finish');}}else if($(this).attr('id')=='qsave_confirm'){$('#control').attr('name','save');}
if(use_test_page_ajax&&!($(this).attr('id')=='qfinish_confirm'||$(this).attr('id')=='qsave_confirm')){window.location.hash="#"+counter++;if(($(this).attr('id')=='feedback_prev')){destination_url=test_web_root+"?noheaderfooter&gb=1#q";send_data='';}else if($(this).attr('id')=='feedback_next'){destination_url=test_web_root+"?noheaderfooter#q";send_data='';}else{if($(this).attr('id').search(/qjump_/i)===0){qid=$(this).attr('id').substring(6);$('#jump_to_this_id_ref').val(qid);}
var destination_url=test_web_root+"accept/?noheaderfooter";var send_data=$("#questionform").serialize();}
$.ajax({type:"POST",url:destination_url,data:send_data,success:function(html_content){var res=html_content.substr(0,9);if(res.search("<!DOCTYPE")===0){window.onbeforeunload=null;window.location.href=test_web_root;return;}
clearTimeoutLoadingError();$('img#icon_loading_kit').stop(true,true).hide();can_click_quiz_button=true;$('html, body').animate({scrollTop:$('#ajax-container').offset().top},'slow',function(){$("#ajax-container").html(html_content);setupDynamicTextAreas();convertBBcodetoHtml();checkBBcodeImageWidths();ajaxRestartTRefresh();});},error:function(jqXHR,textstatus,errorThrown){$('#questions_container').animate({opacity:0.7},10).show();$('#showRefreshInstructions').show();$('html, body').animate({scrollTop:$('#showRefreshInstructions').offset().top-50},'slow');}});}else{if($(this).attr('id').search(/qjump_/i)!==0){window.onbeforeunload=null;$('#questionform').submit();}}}
return false;});$(document).on('click','a#qsave',function(){$(this).fadeOut(400,function(){$('#'+this.id+'_confirm').fadeIn('slow');});return false;});$(document).on('click','a#qfinish',function(){$(this).fadeOut(400,function(){$('#'+this.id+'_confirm').fadeIn('slow');});return false;});$(document).on('click','.fade_content_btn',function(){if(can_click_quiz_button==true){can_click_quiz_button=false;hideAllQuizNavigationButtons();}});$(document).on('click','a#prev_questions',function(){$('#prev_questions').fadeOut();$.getJSON(test_web_root+'rpc/getPrevQuestions.rpc.php',function(data){if(data.response=='success'){var htmlcontent='<table class="qsholder" border="0" cellpadding="0" cellspacing="0">';$.each(data.questions,function(ignore,question){htmlcontent+='<tr><td width="40" valign="top"><a href="#" id="qjump_'+question.qid+'" class="';if($.inArray(question.qid,data.answered_questions)!=-1){htmlcontent+='jump_to_q';}else{htmlcontent+='jump_to_q noanswer';}
htmlcontent+='">'+question.c+'</a></td>';htmlcontent+='<td width="10"><img src="'+test_web_root+'../img/i.gif" width="10" height="1" alt=""/></td>';htmlcontent+='<td><p>'+bbCode(replaceLineBreak(question.question))+'</p></td></tr>';htmlcontent+='<tr><td></td><td></td><td><div class="dotted"></div></td></tr>';});htmlcontent+='</table>';}else{var htmlcontent='<p>';htmlcontent+=data.msg;htmlcontent+='</p>';$('#prev_questions').show();}
$('#display_q_links').html(htmlcontent);$('#display_q_links').slideDown();$('html,body').animate({scrollTop:$('#display_q_links').offset().top-30},'slow');$('img.imgw').show();});});if(!use_test_page_ajax){$(document).on('click','a[id^="qjump_"]',function(e){e.preventDefault();if(can_click_quiz_button==true){can_click_quiz_button=false;qid=this.id.substring(6);$('#jump_to_this_id_ref').val(qid);hideAllQuizNavigationButtons();$('#questionform').submit();}});}
$(document).on('click','[id^="showbtn"], .removeOnBeforeUnload',function(){window.onbeforeunload=null;});function countEssayWords(str){str=$.trim(str);if(str==''){return 0;}else{return str.split(/\s+/).length;}}
$(document).on('keyup','textarea[id^="e_"]',function(e){$('#count'+this.id).html(countEssayWords($('#'+this.id).val()));});$(document).on('click','a[id^="eword_count"]',function(e){e.preventDefault();essay_textbox_id=this.id.substring(11);$('#counte_'+essay_textbox_id).html(countEssayWords($('textarea#e_'+essay_textbox_id).val()));$('#show_'+this.id).toggleClass("hide").toggleClass("show");});$(document).on('click','a[id^="mcundo"]',function(e){e.preventDefault();$('[id^="rmc_'+this.id.substring(6)+'_"]').removeAttr('checked');});$(document).on('click','a[id^="mrundo"]',function(e){e.preventDefault();$('[id^="rmr_'+this.id.substring(6)+'_"]').removeAttr('checked');});$(document).on('click','a[id^="mmrundo"]',function(e){e.preventDefault();$('[id^="rmmr_'+this.id.substring(7)+'_"]').removeAttr('checked');});$(document).on('click','input[class^="mmr_"]',function(){count=$('#c'+this.className).text();if($('[id^="r'+this.className+'_"]').filter(':checked').length>count){alert('You can only select '+ count+' or less options.\n\nYou can unselect an option to make changes.');$('#'+this.id).removeAttr('checked');}});$('#ka').each(function(index){startTRefresh(0);});$('[id^="copyMe_"]').keyup(function(){$("#do"+ this.id).html($('#'+ this.id).val());});$(document).on('keyup','[class*="limitchars"]',function(){limitChars(this.className);});$('#student_overall_top').html($('#student_overall').html()).show();setupDynamicTextAreas();$('.showTooltip').tipsy({gravity:'w',fade:true});$('.showTooltipEast').tipsy({gravity:'e',fade:true,html:true});$('.showTooltipHTML').tipsy({gravity:'w',fade:true,html:true});$('.showTooltipUnder').tipsy({gravity:'n',fade:true});$(document).on('click','.genericSubmitLink',function(e){e.preventDefault();if(disabledGenericSubmitLink==false){if($(this).hasClass('noDisableLink')==false){disabledGenericSubmitLink=true;}
replaceWordCharsAllTextBoxes();$(this).closest("form").submit();if($(this).attr('class').indexOf('noloadinggif',0)==-1){$(this).after(' <img src="'+webpath_img+'icon_loading_circleV3.gif" class="loadingGif"/>');$('.loadingGif').hide(5000);}}});$('#regForm').submit(function(){checking=true;if($('input[name="reg_type"]').val()=='instructor'){$("#regForm").find("input[type=text]").each(function(){if(checking&&$(this).val().length==0&&$(this).attr('name')!='display_name'){alert('All Mandatory * fields are required');checking=false;}});}else{$("#regForm").find("input[type=text]").each(function(){if(checking&&$(this).val().length==0&&!($(this).attr('name')=='email'||$(this).attr('name')=='email2')){alert('All Mandatory * fields are required');checking=false;}});}
return checking;});$("#checkUsername").blur(function(e){if($(this).val()!=''){userName=$(this).val();$("#errDivcheckUsername").remove();$(this).siblings(".ErrDiv").remove();$(this).after('<p class="ErrDiv nopad" id="errDivcheckUsername"></p>');$("#errDivcheckUsername").text("");$("#errDivcheckUsername").css("background-color","#fff").hide(250);postData='username='+ userName;if($(this).hasClass('checking_assistant_username')){postData+='&checking_assistant_username=1';if($('.edit_assistant_id_class').length){postData+='&assistant_id='+ $('.edit_assistant_id_class').val();}}
$.ajax({type:"POST",url:web_root+"register/checkUsername.rpc.php",data:postData,cache:false,dataType:"json",beforeSend:function(x)
{$("#errDivcheckUsername").html("Checking username...");$("#errDivcheckUsername").css("background-color","yellow").fadeIn(1000);},success:function(data)
{if(data.response=='success')
{$("#errDivcheckUsername").css("background-color","#fff");$("#errDivcheckUsername").html(data.msg);$("#errDivcheckUsername").css("color","green").fadeIn(1000);$(".genericSubmitLink").show();}
else
{$("#errDivcheckUsername").css("background-color","#fff");$("#errDivcheckUsername").html(data.msg);$("#errDivcheckUsername").css("color","red").fadeIn(1000);}}});}});$(document).on('click touchend','.viewresultsremovecorrect',function(e){e.preventDefault();$("div[class='qd']").hide();$("div[class='qd']:not(:has(i.qw))").show();});$(document).on('click touchend','.viewresultsshowunmarked',function(e){e.preventDefault();$("div[class='qd']").hide();$("div[class='qd']:has(i.qu)").show();return false;});$(document).on('click touchend','.viewresultsshowall',function(e){e.preventDefault();$("div[class='qd']").show();return false;});$('.selectme').click(function(){this.select();});$('.isRadioChecked').click(function(){if($(this).closest("form").find('input:checked').length!=1){alert('Please select a group');return false;}});$(document).on('click','.popup',function(e){e.preventDefault();window.open($(this).attr('href'));});$(document).on('click','.popupSmall',function(e){e.preventDefault();window.open($(this).attr('href'),'','width=620,height=550,scrollbars=yes,location=no,resizable=yes,menubar=no,toolbar=no,status=no');});$(document).on('submit','.popupForm',function(e){e.preventDefault();var w=window.open($(this).attr('action'),'Popup_Window','toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width=400,height=300,left = 312,top = 234');this.target='Popup_Window';});$('form').submit(function(){replaceWordCharsAllTextBoxes();});var placeHolderSupport=("placeholder"in document.createElement("input"));if(!placeHolderSupport){$('[placeholder]').focus(function(){var input=$(this);if(input.val()==input.attr('placeholder')){input.val('');input.removeClass('placeholder');}}).blur(function(){var input=$(this);if(input.val()==''||input.val()==input.attr('placeholder')){input.addClass('placeholder');input.val(input.attr('placeholder'));}}).blur();$('[placeholder]').parents('form').submit(function(){$(this).find('[placeholder]').each(function(){var input=$(this);if(input.val()==input.attr('placeholder')){input.val('');}})});}
var sortAsc,sortBy;$(document).on('click','.sort-trigger',function(e){e.preventDefault();if($(this).attr('data-sort')==='asc'){sortAsc=true;$(this).attr('data-sort','desc');}else{sortAsc=false;$(this).attr('data-sort','asc');}
if($(this).attr('data-sort-by')==='percentage_duration'){sortBy='percentage_duration';}else if($(this).attr('data-sort-by')==='percentage_textduration'){sortBy='percentage_textduration';}else if($(this).attr('data-sort-by')==='percentage'){sortBy='percentage';}else if($(this).attr('data-sort-by')==='date'){sortBy='date';}else if($(this).attr('data-sort-by')==='duration'){sortBy='duration';}else if($(this).attr('data-sort-by')==='textduration'){sortBy='textduration';}else if($(this).attr('data-sort-by')==='name'){sortBy='name';}else if($(this).attr('data-sort-by')==='attempts'){sortBy='attempts';}
sortResults($(this).closest('div.table').find('.sort-data-set > li'));});function compare(a,b){if(!sortAsc){var t=a;a=b;b=t;}
if(sortBy=='percentage_duration'||sortBy=='percentage_textduration'){if(a.percentage==b.percentage){if(a.duration>b.duration)return-1;if(a.duration<b.duration)return 1;}
if(a.percentage<b.percentage)return-1;if(a.percentage>b.percentage)return 1;}else if(sortBy=='percentage'){if(a.percentage<b.percentage)return-1;if(a.percentage>b.percentage)return 1;}else if(sortBy=='date'){if(a.date>b.date)return-1;if(a.date<b.date)return 1;}else if(sortBy=='duration'||sortBy=='textduration'){if(a.duration>b.duration)return-1;if(a.duration<b.duration)return 1;}else if(sortBy=='attempts'){if(a.attempts>b.attempts)return-1;if(a.attempts<b.attempts)return 1;}else if(sortBy=='name'){return a.name.localeCompare(b.name);}
return 0;}
function sortResults(listItems){var listItemsObjects=[];listItems.each(function(){var listItem={};listItem.elem=$(this);if(sortBy=='percentage_duration'){listItem.percentage=parseFloat($(this).attr("data-percentage"));listItem.duration=parseInt($(this).attr("data-duration"));}else if(sortBy=='percentage_textduration'){listItem.percentage=parseFloat($(this).attr("data-percentage"));listItem.duration=$(this).attr("data-duration");}else if(sortBy=='percentage'){listItem.percentage=parseFloat($(this).attr("data-percentage"));}else if(sortBy=='date'){listItem.date=parseInt($(this).attr("data-date"));}else if(sortBy=='duration'){listItem.duration=parseInt($(this).attr("data-duration"));}else if(sortBy=='textduration'){listItem.duration=$(this).attr("data-duration");}else if(sortBy=='attempts'){listItem.attempts=parseInt($(this).attr("data-attempts"));}else if(sortBy=='name'){if($(this).attr("data-name")){listItem.name=$(this).attr("data-name").toLowerCase();}
else{return;}}
listItemsObjects.push(listItem);});listItemsObjects.sort(compare);$.each(listItemsObjects,function(index,item){item.elem.appendTo(item.elem.parent());});}
$(".navnext").delay(1000).delay(500).fadeOut(500).delay(10).fadeIn(500);$(".navnext").click(function(e){e.preventDefault();show_tour_div++;changeTour(show_tour_div);});$(".navprev").click(function(e){e.preventDefault();show_tour_div--;changeTour(show_tour_div);});$("ul.slider-pagination li").click(function(e){e.preventDefault();show_tour_div=$("ul.slider-pagination li").index($(this));changeTour(show_tour_div);});var show_tour_div=0;function changeTour(show_tour_div){$("#pagecount").text(show_tour_div);$("[id^='tourimg_'], [id^='tourtext_']").hide();$("#tourimg_"+show_tour_div+", #tourtext_"+show_tour_div).show();if(show_tour_div<10){$(".navnext").show();}else{$(".navnext").hide();}
if(show_tour_div>0){$(".navprev").show();}else{$(".navprev").hide();}
$('#slider-position-display').text(show_tour_div+1);$("ul.slider-pagination li").removeClass('active');$("ul.slider-pagination li:eq("+show_tour_div+")").addClass("active");}
if(typeof(asset_image_allow_toggle)=="undefined"){asset_image_allow_toggle=true;}
if(typeof(asset_image_toggle_max_width)=="undefined"){asset_image_toggle_max_width=500;}
convertBBcodetoHtml();checkBBcodeImageWidths();});function setupDynamicTextAreas(){$(document).on('keyup','textarea',function(){sz(this);});$(document).on('focus','textarea',function(){sz(this);});}
function convertBBcodetoHtml(){$(".bbcode").each(function(e){$(this).html(bbCode($(this).html()));});}
function checkBBcodeImageWidths(){var noOfImages=$('img.imgw').length;var noOfImagesLoaded=0;$('img.imgw').on('error',function(){$(this).prop('src','https://www.classmarker.com/img3/i.gif');});$('img.imgw').on('load',function(){noOfImagesLoaded++;if(noOfImages&&noOfImages===noOfImagesLoaded){$('img.imgw').each(function(){var original_img_width=$(this).width();$(this).css('max-width',asset_image_toggle_max_width+'px');$(this).show();if(asset_image_allow_toggle&&original_img_width>asset_image_toggle_max_width){showImageEnlargeIcon($(this));}});$('img.js_toggle_image_width_trigger, img.remove_on_enlarge').on('click',function(){if($(this).hasClass('remove_on_enlarge')){var img_to_toggle_width=$(this).prev();}else{var img_to_toggle_width=$(this);}
$('img.remove_on_enlarge').remove();if(img_to_toggle_width.css('max-width')!='none'){img_to_toggle_width.css('max-width','');}else{img_to_toggle_width.css('max-width',asset_image_toggle_max_width+'px');}});}});}
var disabledGenericSubmitLink=false;function showImageEnlargeIcon(element){element.addClass('js_toggle_image_width_trigger');var pos=element.position();var img=$('<img class="remove_on_enlarge"/>');img.attr('src','https://www.classmarker.com/img3/icon_enlarge.png');$(img).css({position:"absolute",width:"27px",top:(pos.top+ 5)+"px",left:(pos.left+ 5)+"px",borderTopLeftRadius:8,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8,opacity:0.6,border:"1px solid #444",padding:"2px"});element.after(img);}
function inIframe(){try{return window.self!==window.top;}catch(e){return true;}}
function openerExists(){if(window.opener&&window.opener.open&&!window.opener.closed){return true;}else{return false;}}
var timeout_session_holder;function startTRefresh(cm_count){if(typeof ka_path=='undefined'){return;}
if(cm_count>0){$.getJSON(ka_path+'&'+ Math.floor(Math.random()*480000),function(json){try{if(json.hasOwnProperty('warn_logged_out_msg')){alert(json.warn_logged_out_msg);}}catch(err){}});}
cm_count++;if(cm_count<45){timeout_session_holder=setTimeout('startTRefresh('+ cm_count+')',480000);}}
function ajaxRestartTRefresh(){clearTimeout(timeout_session_holder);startTRefresh(0);}
var timeout_loading_error_holder;function startTimeoutLoadingError(){timeout_loading_error_holder=setTimeout('displayTimeoutLoadingError()',90000);}
function displayTimeoutLoadingError(){window.onbeforeunload=null;$('img#icon_loading_kit').hide();$('#questions_container').animate({opacity:0.7},10).show();$('#showRefreshInstructions').show();$('html, body').animate({scrollTop:$('#showRefreshInstructions').offset().top-50},'slow');}
function clearTimeoutLoadingError(){clearTimeout(timeout_loading_error_holder);}
function bbCode(str){if(str.indexOf("[")==-1){return str;}
var result=XBBCODE.process({text:str,removeMisalignedTags:false,addInLineBreaks:false});return result.html;}
var asset_ref_dir=new Array(/(0\/)/,/(1\/)/,/(2\/)/);var asset_actual_dir=new Array('https://0cm.classmarker.com/','https://1cm.classmarker.com/','https://2cm.classmarker.com/');function getDocPathForDropDown(str){for(i=0;i<asset_ref_dir.length;i++){str=str.replace(asset_ref_dir[i],asset_actual_dir[i]);}
return str;}
if(!Array.prototype.filter)
{Array.prototype.filter=function(fun)
{"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!="function")
throw new TypeError();var res=[];var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in t)
{var val=t[i];if(fun.call(thisp,val,i,t))
res.push(val);}}
return res;};}
function sz(t){a=t.value.split('\n');b=1;for(x=0;x<a.length;x++){if(a[x].length>=t.cols)b+=Math.floor(a[x].length/t.cols);}
b+=a.length;t.rows=b;}
function nl2br(myString){var regX=/\\n/g;var replaceString='<br>';return myString.replace(regX,replaceString);}
function cleanText(text){text=text.replace(/–/g,'-');text=text.replace(/“/g,'"');text=text.replace(/”/g,'"');text=text.replace(/‘/g,'\'');text=text.replace(/’/g,'\'');text=text.replace(/…/g,'...');return text;}
function replaceWordChars(text){text=text.replace(/–/g,'-');text=text.replace(/−/g,'-');text=text.replace(/“/g,'"');text=text.replace(/”/g,'"');text=text.replace(/‘/g,"'");text=text.replace(/’/g,"'");text=text.replace(/‛/g,"'");text=text.replace(/…/g,'...');return text;}
function replaceWordCharsAllTextBoxes(){$("textarea").each(function(){$(this).val(replaceWordChars($(this).val()));});$('input:text').each(function(){$(this).val(replaceWordChars($(this).val()));});}
function trim(str){return str.replace(/^\s*/,"").replace(/\s*$/,"").replace(/||||/,"");}
function checkHttpLink(str){if((str!=''&&str!=undefined)&&(!str.toLowerCase().indexOf('https://')==0&&!str.toLowerCase().indexOf('http://')==0)){return false;}else{return true;}}
function limitChars(className)
{var classes=className.split(' ');for(var i=0;i<classes.length;i++){if(classes[i].search(/limitchars_/i)!=-1){className=classes[i];}}
var identifier=className.split('_')[1];var limit=className.split('_')[2];var text=$('.'+className).val();var textlength=text.length;if(textlength>100){$('.'+ identifier+'_info').show();}
if(textlength>limit)
{$('.'+className).val(text.substr(0,limit));return false;}
else
{$('.'+ identifier+'_info').html(limit- textlength);return true;}}
function replaceLineBreak(str){if(str.length){str=str.replace(/\</g,'&lt;');str=str.replace(/\>/g,'&gt;');return str.replace(/\r?\n/g,'<br />');}else{return str;}}
function checkEmail(email){if($('#'+email).val().length<5||$('#'+email).val().indexOf('@')==-1||$('#'+email).val().indexOf('.')==-1){return false;}else{return true;}}
function jqCheckAll(id,name){if($('#'+id).is(':checked')){$("input[name^="+ name+"][type='checkbox']").prop('checked',true);}else{$("input[name^="+ name+"][type='checkbox']").prop('checked',false);}}
function navMouseOver(){$('#'+ this.id+' ul').css('display','block');}
function navMouseOverOut(){$('#'+ this.id+' ul').css('display','none');}
var XBBCODE=(function(){"use strict";var s3_assets_path='https://';var me={},urlPattern=/^(http|mailto)/,imgPattern=/^http/,colorNamePattern=/^(?:red|green|blue|orange|yellow|black|white|brown|gray|silver|purple|maroon|fushsia|lime|olive|navy|teal|aqua)$/,colorCodePattern=/^#?[a-fA-F0-9]{6}$/,tags,tagList,tagsNoParseList=[],bbRegExp,pbbRegExp,pbbRegExp2,openTags,closeTags;tags={"b":{openTag:function(params,content){return'<strong>';},closeTag:function(params,content){return'</strong>';}},"bbcode":{openTag:function(params,content){return'';},closeTag:function(params,content){return'';}},"color":{openTag:function(params,content){var colorCode=params.substr(1)||"black";colorNamePattern.lastIndex=0;colorCodePattern.lastIndex=0;if(!colorNamePattern.test(colorCode)){if(!colorCodePattern.test(colorCode)){colorCode="black";}else{if(colorCode.substr(0,1)!=="#"){colorCode="#"+ colorCode;}}}
return'<span style="color:'+ colorCode+'">';},closeTag:function(params,content){return'</span>';}},"i":{openTag:function(params,content){return'<i>';},closeTag:function(params,content){return'</i>';}},"img":{openTag:function(params,content){var myUrl=content;urlPattern.lastIndex=0;if(!imgPattern.test(myUrl)){myUrl="";}
return'<img src="'+ myUrl+'" class="imgw" alt="" border="0" />';},closeTag:function(params,content){return'';},displayContent:false},"email":{openTag:function(params,content){var myUrl;if(!params){myUrl=content.replace(/<.*?>/g,"");}else{myUrl=params.substr(1);}
return'<a href="mailto:'+ myUrl+'" class="popup">';},closeTag:function(params,content){return'</a>';}},"cmimg":{openTag:function(params,content){var path=content.replace(/<.*?>/g,"");var pathArray=path.split("/");if(pathArray.length==2){return'<img src="'+s3_assets_path+ pathArray[0]+'cm.classmarker.com/'+ pathArray[1]+'" class="imgw" alt="" border="0" />';}},closeTag:function(params,content){return'';},displayContent:false},"cmvideo":{openTag:function(params,content){return'<video  data-cmvideo-url="'+ content+'" width="560" height="315" controls> <source class="sceditor-ignore" src="'+ getDocPathForDropDown(content)+'" type="video/mp4">'+ audio_video_warning+'</video>';},closeTag:function(params,content){return'';},displayContent:false},"exvideo":{openTag:function(params,content){return'<video data-exvideo-url="'+ content+'" width="560" height="315" controls> <source class="sceditor-ignore" src="'+ content+'" type="video/mp4">'+ audio_video_warning+'</video>';},closeTag:function(params,content){return'';},displayContent:false},"cmaudio":{openTag:function(params,content){var path=content.replace(/<.*?>/g,"");var pathArray=path.split("/");if(pathArray.length==2){return'<audio data-cmaudio-url="'+ path+'" controls> <source class="sceditor-ignore" src="'+ getDocPathForDropDown(path)+'" type="audio/mpeg">'+ audio_video_warning+'</audio>';}},closeTag:function(params,content){return'';},displayContent:false},"exaudio":{openTag:function(params,content){return'<audio data-exaudio-url="'+ content+'" controls> <source class="sceditor-ignore" src="'+ content+'" type="audio/mpeg">'+ audio_video_warning+'</audio>';},closeTag:function(params,content){return'';},displayContent:false},"soundcloud":{openTag:function(params,content){if(typeof isMSIE8!=='undefined'){return audio_video_warning;}else{return'<div class="video-container"><iframe width="600" height="160" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?visual=true&url='+content+'&show_artwork=true&auto_play=false&maxheight=160&maxwidth=600"></iframe></div>';}},closeTag:function(params,content){return'';},displayContent:false},"cmdoc":{openTag:function(params,content){var path=params.substr(1);var pathArray=path.split("/");if(pathArray.length==2){return'<a href="'+s3_assets_path+ pathArray[0]+'cm.classmarker.com/'+ pathArray[1]+'" class="popup">';}else{return'<a href="javascript:alert(\'Invalid document link.\');">';}},closeTag:function(params,content){return'</a>';},displayContent:true},"ul":{openTag:function(params,content){return'<ul>';},closeTag:function(params,content){return'</ul>';},restrictChildrenTo:["*","li"]},"ol":{openTag:function(params,content){return'<ol>';},closeTag:function(params,content){return'</ol>';},restrictChildrenTo:["*","li"]},"li":{openTag:function(params,content){return"<li>";},closeTag:function(params,content){return"</li>";},restrictParentsTo:["ul","li"]},"s":{openTag:function(params,content){return'<del>';},closeTag:function(params,content){return'</del>';}},"sup":{openTag:function(params,content){return'<span class="sup">';},closeTag:function(params,content){return'</span>';}},"sub":{openTag:function(params,content){return'<span class="sub">';},closeTag:function(params,content){return'</span>';}},"sqr":{openTag:function(params,content){return'&radic;<span class="sqr">';},closeTag:function(params,content){return'</span>';}},"size":{openTag:function(params,content){var mySize=parseInt(params.substr(1),10)||0;if(mySize<1||mySize>7){mySize=2;}
return'<span class="bbcodeSize'+ mySize+'">';},closeTag:function(params,content){return'</span>';}},"table":{openTag:function(params,content){return' <div class="cm-table-responsive"><table class="bbcodeTable">';},closeTag:function(params,content){return'</table></div>';},restrictChildrenTo:["tbody","thead","tfoot","tr"]},"tbody":{openTag:function(params,content){return'<tbody>';},closeTag:function(params,content){return'</tbody>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"tfoot":{openTag:function(params,content){return'<tfoot>';},closeTag:function(params,content){return'</tfoot>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"thead":{openTag:function(params,content){return'<thead>';},closeTag:function(params,content){return'</thead>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"td":{openTag:function(params,content){return'<td>';},closeTag:function(params,content){return'</td>';},restrictParentsTo:["tr"]},"th":{openTag:function(params,content){return'<td>';},closeTag:function(params,content){return'</td>';},restrictParentsTo:["tr"]},"tr":{openTag:function(params,content){return'<tr>';},closeTag:function(params,content){return'</tr>';},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},"u":{openTag:function(params,content){return'<u>';},closeTag:function(params,content){return'</u>';}},"url":{openTag:function(params,content){var myUrl;if(!params){myUrl=content.replace(/<.*?>/g,"");}else{myUrl=params.substr(1);}
urlPattern.lastIndex=0;if(!urlPattern.test(myUrl)){myUrl="javascript:alert('Invalid link was entered here.');";}
return'<a href="'+ myUrl+'" class="popup">';},closeTag:function(params,content){return'</a>';}},"yt":{openTag:function(params,content){var myYouTubeId=content.replace(/<.*?>/g,"");if(myYouTubeId.length!=11){myYouTubeId="";}
if(useIframe()){return'<br /><div class="video-container"><object width="560" height="315"><param name="movie" value="https://www.youtube.com/v/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="https://www.youtube.com/v/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="560" height="315"></embed></object></div>';}else{return'<br /><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe></div>';}},closeTag:function(params,content){return'';},displayContent:false},"vimeo":{openTag:function(params,content){var myVimeoUrlId=content.replace(/<.*?>/g,"");if(urlPattern.test(myVimeoUrlId)){myVimeoUrlId="";}
return'<br /><div class="video-container"><iframe src="https://player.vimeo.com/video/'+myVimeoUrlId+'?title=0&amp;byline=0&amp;portrait=1" width="560" height="315" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></div>';},closeTag:function(params,content){return'';},displayContent:false},"*":{openTag:function(params,content){return"<li>";},closeTag:function(params,content){return"</li>";},restrictParentsTo:["list"]}};tagList=[];(function(){var prop,ii,len;for(prop in tags){if(tags.hasOwnProperty(prop)){if(prop==="*"){tagList.push("\\"+ prop);}else{tagList.push(prop);if(tags[prop].noParse){tagsNoParseList.push(prop);}}
tags[prop].validChildLookup={};tags[prop].validParentLookup={};tags[prop].restrictParentsTo=tags[prop].restrictParentsTo||[];tags[prop].restrictChildrenTo=tags[prop].restrictChildrenTo||[];len=tags[prop].restrictChildrenTo.length;for(ii=0;ii<len;ii++){tags[prop].validChildLookup[tags[prop].restrictChildrenTo[ii]]=true;}
len=tags[prop].restrictParentsTo.length;for(ii=0;ii<len;ii++){tags[prop].validParentLookup[tags[prop].restrictParentsTo[ii]]=true;}}}})();bbRegExp=new RegExp("<bbcl=([0-9]+) ("+ tagList.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi");pbbRegExp=new RegExp("\\[("+ tagList.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi");pbbRegExp2=new RegExp("\\[("+ tagsNoParseList.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi");(function(){var closeTagList=[];for(var ii=0;ii<tagList.length;ii++){if(tagList[ii]!=="\\*"){closeTagList.push("/"+ tagList[ii]);}}
openTags=new RegExp("(\\[)((?:"+ tagList.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi");closeTags=new RegExp("(\\[)("+ closeTagList.join("|")+")(\\])","gi");})();function checkParentChildRestrictions(parentTag,bbcode,bbcodeLevel,tagName,tagParams,tagContents,errQueue){errQueue=errQueue||[];bbcodeLevel++;var reTagNames=new RegExp("(<bbcl="+ bbcodeLevel+" )("+ tagList.join("|")+")([ =>])","gi"),reTagNamesParts=new RegExp("(<bbcl="+ bbcodeLevel+" )("+ tagList.join("|")+")([ =>])","i"),matchingTags=tagContents.match(reTagNames)||[],cInfo,errStr,ii,childTag,pInfo=tags[parentTag]||{};reTagNames.lastIndex=0;if(!matchingTags){tagContents="";}
for(ii=0;ii<matchingTags.length;ii++){reTagNamesParts.lastIndex=0;childTag=(matchingTags[ii].match(reTagNamesParts))[2].toLowerCase();if(pInfo.restrictChildrenTo.length>0){if(!pInfo.validChildLookup[childTag]){errStr="The tag \""+ childTag+"\" is not allowed as a child of the tag \""+ parentTag+"\".";errQueue.push(errStr);}}
cInfo=tags[childTag]||{};if(cInfo.restrictParentsTo.length>0){if(!cInfo.validParentLookup[parentTag]){errStr="The tag \""+ parentTag+"\" is not allowed as a parent of the tag \""+ childTag+"\".";errQueue.push(errStr);}}}
tagContents=tagContents.replace(bbRegExp,function(matchStr,bbcodeLevel,tagName,tagParams,tagContents){errQueue=checkParentChildRestrictions(tagName,matchStr,bbcodeLevel,tagName,tagParams,tagContents,errQueue);return matchStr;});return errQueue;}
function updateTagDepths(tagContents){tagContents=tagContents.replace(/\<([^\>][^\>]*?)\>/gi,function(matchStr,subMatchStr){var bbCodeLevel=subMatchStr.match(/^bbcl=([0-9]+) /);if(bbCodeLevel===null){return"<bbcl=0 "+ subMatchStr+">";}else{return"<"+ subMatchStr.replace(/^(bbcl=)([0-9]+)/,function(matchStr,m1,m2){return m1+(parseInt(m2,10)+ 1);})+">";}});return tagContents;}
function unprocess(tagContent){return tagContent.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;");}
var replaceFunct=function(matchStr,bbcodeLevel,tagName,tagParams,tagContents){tagName=tagName.toLowerCase();var processedContent=tags[tagName].noParse?unprocess(tagContents):tagContents.replace(bbRegExp,replaceFunct),openTag=tags[tagName].openTag(tagParams,processedContent),closeTag=tags[tagName].closeTag(tagParams,processedContent);if(tags[tagName].displayContent===false){processedContent="";}
return openTag+ processedContent+ closeTag;};function parse(config){var output=config.text;output=output.replace(bbRegExp,replaceFunct);return output;}
function fixStarTag(text){text=text.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/ig,"<");text=text.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/ig,">");while(text!==(text=text.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(matchStr,contents,endTag){var innerListTxt=matchStr;while(innerListTxt!==(innerListTxt=innerListTxt.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(matchStr,contents,endTag){if(endTag===">/list]"){endTag="</*]</list]";}else{endTag="</*][*]";}
var tmp="<*]"+ contents+ endTag;return tmp;})));innerListTxt=innerListTxt.replace(/>/g,"<");return innerListTxt;})));text=text.replace(/</g,"[");return text;};function addBbcodeLevels(text){while(text!==(text=text.replace(pbbRegExp,function(matchStr,tagName,tagParams,tagContents){matchStr=matchStr.replace(/\[/g,"<");matchStr=matchStr.replace(/\]/g,">");return updateTagDepths(matchStr);})));return text;}
me.process=function(config){var ret={html:"",error:false},errQueue=[];config.text=config.text.replace(/(<br\/>|<br \/>|<br>|<br >)/ig,"x6yWQ4Vs");config.text=config.text.replace(/</g,"&lt;");config.text=config.text.replace(/>/g,"&gt;");config.text=config.text.replace(openTags,function(matchStr,openB,contents,closeB){return"<"+ contents+">";});config.text=config.text.replace(closeTags,function(matchStr,openB,contents,closeB){return"<"+ contents+">";});config.text=config.text.replace(/\[/g,"&#91;");config.text=config.text.replace(/\]/g,"&#93;");config.text=config.text.replace(/</g,"[");config.text=config.text.replace(/>/g,"]");while(config.text!==(config.text=config.text.replace(pbbRegExp2,function(matchStr,tagName,tagParams,tagContents){tagContents=tagContents.replace(/\[/g,"&#91;");tagContents=tagContents.replace(/\]/g,"&#93;");tagParams=tagParams||"";tagContents=tagContents||"";return"["+ tagName+ tagParams+"]"+ tagContents+"[/"+ tagName+"]";})));config.text=fixStarTag(config.text);config.text=addBbcodeLevels(config.text);errQueue=checkParentChildRestrictions("bbcode",config.text,-1,"","",config.text);ret.html=parse(config);if(ret.html.indexOf("[")!==-1||ret.html.indexOf("]")!==-1){errQueue.push("Some tags appear to be misaligned.");}
if(config.removeMisalignedTags){ret.html=ret.html.replace(/\[.*?\]/g,"");}
if(config.addInLineBreaks){ret.html=ret.html.replace(/\r\n/g,"\n");ret.html=ret.html.replace(/(\r|\n)/g,"$1<br/>");}
ret.html=ret.html.replace("&#91;","[");ret.html=ret.html.replace("&#93;","]");ret.html=ret.html.replace(/x6yWQ4Vs/g,"<br/>");ret.error=(errQueue.length===0)?false:true;ret.errorQueue=errQueue;return ret;}
return me;})();function useIframe(){if(navigator.appVersion.indexOf("MSIE 9.")==-1&&navigator.appVersion.indexOf("MSIE 8.")==-1&&navigator.appVersion.indexOf("MSIE 7.")==-1&&navigator.appVersion.indexOf("MSIE 6.")==-1){return false;}
return true;}