$(document).ready(function(){$.sceditorBBCodePlugin.bbcode.remove('font').remove('horizontalrule').remove('quote').remove('youtube').remove('right').remove('left').remove('center').remove('justify');$.sceditor.command.set("square",{exec:function(){var squareroot=prompt('Enter value to place under the Square root line:\n','');var editor_value=$('#'+ this.id+' iframe').contents().find('body').html();if(squareroot===null||squareroot.length===0){}else{this.wysiwygEditorInsertHtml('<span class="square" data-square-value="'+ squareroot+'" >√<span class="sqr">&nbsp;'+ squareroot+'</span></span>&nbsp;');}},tooltip:"Square Root"});$.sceditor.command.set("color",{_dropDown:function(editor,caller,callback){var i,x,color,colors,content=$("<div />"),html=[],cmd=$.sceditor.command.get('color');html.push('<div class="sceditor-color-row">');html.push('<p class="sceditor-color-heading-select">Select Color</p>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: black" data-color="#000000"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: red" data-color="#FF0000"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: Cornflowerblue" data-color="#6495ED"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: blue" data-color="#0000FF"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: green" data-color="#008000"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: navy" data-color="#000080"></a>');html.push('</div>');html.push('</div><div class="sceditor-color-row">');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: purple" data-color="#800080"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: maroon" data-color="#800000"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: teal" data-color="#008080"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: deeppink" data-color="#FF1493"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: orangered" data-color="#FF4500"></a>');html.push('</div>');html.push('<div class="sceditor-color-column">');html.push('<a href="#" class="sceditor-color-option" style="background-color: grey" data-color="#808080"></a>');html.push('</div>');html.push('<div class="sceditor-color-code">');html.push('<p class="sceditor-color-heading-code">Color Code</p><p class="sceditor-color-example">Example: #0033FF</p><input type="text" class="color-text"/><span class="btn color-check-button" onclick="colorText();">Check color</span>');html.push('<div class="show-color hide"><a href="#" class="sceditor-color-option sceditor-color-option-custom" style="background-color: black" data-color="#000000"></a></div><p class="color-click hide">click color to use<p>');html.push('</div>');html.push('</div>');cmd._htmlCache=html.join('');content.append(cmd._htmlCache).find('a').click(function(e){callback($(this).attr('data-color'));editor.closeDropDown(true);e.preventDefault();});editor.createDropDown(caller,"color-picker",content);},exec:function(caller){var editor=this;$.sceditor.command.get('color')._dropDown(editor,caller,function(color){editor.execCommand("forecolor",color);});},tooltip:"Font Color"});$.sceditor.command.set("yt",{exec:function(){$('#fileSelectorDiv').jqmShow();$('#obj_ref').text(this.opts.id.replace('editor_',''));$('#test_vimeo_video_id').val('');$('#vimeoVideo').html('');$('.vimeoVideoId').show();$('.vimeoDemo').hide();$('#test_video_id').val('');$('#youtubeVideo').html('');$('.youtubeVideoId').show();$('.youtubeDemo').hide();}});$.sceditor.command.set("size",{_dropDown:function(editor,caller,callback){var content=$("<div />"),html=[],clickFunc=function(e){callback($(this).data('size'));editor.closeDropDown(true);e.preventDefault();};html.push('<a class="sceditor-fontsize-option" data-size="1" href="#" unselectable="on"><font size="1" unselectable="on">Small</font></a>');html.push('<a class="sceditor-fontsize-option" data-size="2" href="#" unselectable="on"><font size="2" unselectable="on">Normal</font></a>');html.push('<a class="sceditor-fontsize-option" data-size="3" href="#" unselectable="on"><font size="3" unselectable="on">Large</font></a>');html.push('<a class="sceditor-fontsize-option" data-size="4" href="#" unselectable="on"><font size="4" unselectable="on">Largest</font></a>');content.append(html.join('')).find('a').click(function(e){callback($(this).attr('data-size'));editor.closeDropDown(true);e.preventDefault();});editor.createDropDown(caller,"fontsize-picker",content);},exec:function(caller){var editor=this;$.sceditor.command.get('size')._dropDown(editor,caller,function(fontSize){editor.execCommand("fontsize",fontSize);});},tooltip:"Font Size"});$.sceditor.command.set("pastetext",{exec:function(caller){var val,editor=this,content=$('<div><label for="txt">Paste your text inside the following box: <a class=\"why-paste\" href=\"javascript: alert(\'This is to stop incompatible text formatting being added from another application which can interfere with the final look of your text.\')\">Why?</a></label> '+'<textarea cols="20" rows="2" id="txt"></textarea></div>'+'<div><input type="button" class="button" value="Insert" /></div>');content.find('.button').click(function(e){val=content.find('#txt').val();if(val)
editor.wysiwygEditorInsertText(val);editor.closeDropDown(true);e.preventDefault();});editor.createDropDown(caller,'pastetext',content);},tooltip:'Paste Text'});$.sceditor.command.set("table",{exec:function(caller){var editor=this,content=$('<div><label for="rows">Rows:</label><input type="text" id="rows" value="2" /></div>'+'<div><label for="cols">Cols:</label><input type="text" id="cols" value="2" /></div>'+'<div><input type="button" class="button" value="Insert" /></div>');content.find('.button').click(function(e){var rows=content.find('#rows').val()- 0,cols=content.find('#cols').val()- 0,html='<table class="bbcodeTable">';if(rows<1||cols<1)
return;for(var row=0;row<rows;row++){html+='<tr>';for(var col=0;col<cols;col++)
html+='<td>'+($.sceditor.ie?'':'<br />')+'</td>';html+='</tr>';}
html+='</table>';editor.wysiwygEditorInsertHtml(html);editor.closeDropDown(true);e.preventDefault();});editor.createDropDown(caller,'inserttable',content);},tooltip:'Insert a table'});$.sceditor.plugins.bbcode.bbcode.set("yt",{allowsEmpty:true,tags:{iframe:{'data-youtube-id':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-youtube-id')))
return content;return'[yt]'+ element.attr('data-youtube-id')+'[/yt]';},html:'<iframe width="225" height="185" src="https://www.youtube.com/embed/{0}?wmode=opaque&amp;rel=0&amp;showsearch=0&amp;showinfo=0'+'" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'});$.sceditor.plugins.bbcode.bbcode.set("vimeo",{allowsEmpty:true,tags:{iframe:{'data-vimeo-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-vimeo-url')))
return content;return'[vimeo]'+ element.attr('data-vimeo-url')+'[/vimeo]';},html:'<iframe data-vimeo-url="{0}" src="https://player.vimeo.com/video/{0}" width="225" height="185" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'});$.sceditor.plugins.bbcode.bbcode.set("cmvideo",{allowsEmpty:true,tags:{iframe:{'data-cmvideo-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-cmvideo-url')))
return content;return'[cmvideo]'+ element.attr('data-cmvideo-url')+'[/cmvideo]';},html:function(token,attrs,content){return'<iframe class="black-background" width="242" height="197" src="'+web_root+'videoaudioiframe.php?type=cmvideo&content='+ content+'" data-cmvideo-url="'+ content+'"  frameborder="0" allowfullscreen></iframe>';}});$.sceditor.plugins.bbcode.bbcode.set("exvideo",{allowsEmpty:true,tags:{iframe:{'data-exvideo-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-exvideo-url')))
return content;return'[exvideo]'+ element.attr('data-exvideo-url')+'[/exvideo]';},html:function(token,attrs,content){return'<iframe class="black-background" width="242" height="197" src="'+web_root+'videoaudioiframe.php?type=exvideo&content='+ content+'" data-exvideo-url="'+ content+'"  frameborder="0" allowfullscreen></iframe>';}});$.sceditor.plugins.bbcode.bbcode.set("cmaudio",{allowsEmpty:true,tags:{iframe:{'data-cmaudio-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-cmaudio-url')))
return content;return'[cmaudio]'+ element.attr('data-cmaudio-url')+'[/cmaudio]';},html:function(token,attrs,content){return'<iframe width="300" height="30" src="'+web_root+'videoaudioiframe.php?type=cmaudio&content='+ content+'" data-cmaudio-url="'+ content+'"  frameborder="0"></iframe>';}});$.sceditor.plugins.bbcode.bbcode.set("exaudio",{allowsEmpty:true,tags:{iframe:{'data-exaudio-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-exaudio-url')))
return content;return'[exaudio]'+ element.attr('data-exaudio-url')+'[/exaudio]';},html:function(token,attrs,content){return'<iframe width="300" height="30" src="'+web_root+'videoaudioiframe.php?type=exaudio&content='+ content+'" data-exaudio-url="'+ content+'"  frameborder="0"></iframe>';}});$.sceditor.plugins.bbcode.bbcode.set("soundcloud",{allowsEmpty:true,tags:{video:{'data-soundcloud-url':null}},isInline:true,isHtmlInline:true,format:function(element,content){if(!(element.attr('data-soundcloud-url')))
return content;return'[soundcloud]'+ element.attr('data-soundcloud-url')+'[/soundcloud]';},html:function(token,attrs,content){return'<iframe width="380" height="160" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?visual=true&url='+content+'&show_artwork=true&auto_play=false&maxheight=160&maxwidth=380"></iframe>';}});$.sceditor.plugins.bbcode.bbcode.set("img",{allowsEmpty:true,tags:{img:{src:null}},quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(element,content){var attribs='',style=function(name){return element.style?element.style[name]:null;};if(typeof element.attr('data-sceditor-emoticon')!=="undefined")
return content;if(typeof element.attr('data-cmimg-url')!=="undefined"){return content;}else{return'[img'+ attribs+']'+ element.attr('src')+'[/img]';}},html:function(token,attrs,content){var parts,attribs='';if(typeof attrs.width!=="undefined")
attribs+=' width="'+ attrs.width+'"';if(typeof attrs.height!=="undefined")
attribs+=' height="'+ attrs.height+'"';if(typeof attrs.defaultattr!=="undefined"){parts=attrs.defaultattr.split(/x/i);attribs=' width="'+ parts[0]+'"'+' height="'+(parts.length===2?parts[1]:parts[0])+'"';}
return'<img'+ attribs+' src="'+ content+'" class="previewImg"/>';}});$.sceditor.plugins.bbcode.bbcode.set("cmimg",{allowsEmpty:true,tags:{img:{'data-cmimg-url':null}},format:function(element,content){if(!(element.attr('data-cmimg-url')))
return content;return'[cmimg]'+ element.attr('data-cmimg-url')+'[/cmimg]';},html:function(token,attrs,content){return'<img data-cmimg-url="'+ content+'" src="'+ getDocPathForDropDown(content)+'" class="previewImg"/>';}});$.sceditor.plugins.bbcode.bbcode.set("url",{allowsEmpty:true,tags:{a:{href:null}},quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(element,content){var url=element.attr('href');if(element.attr('data-cmdoc-url'))
return;return'[url='+ decodeURI(url)+']'+ content+'[/url]';},html:function(token,attrs,content){if(typeof attrs.defaultattr==="undefined"||attrs.defaultattr.length===0)
attrs.defaultattr=content;return'<a href="'+ encodeURI(attrs.defaultattr)+'" class="popup">'+ content+'</a>';}});$.sceditor.plugins.bbcode.bbcode.set("cmdoc",{allowsEmpty:true,tags:{a:{'data-cmdoc-url':null}},quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(element,content){var url=element.attr('href');if(!element.attr('data-cmdoc-url'))
return;return'[cmdoc="'+ element.attr('data-cmdoc-url')+'"]'+ $.trim(element.text())+'[/cmdoc]';},html:function(token,attrs,content){return'<a data-cmdoc-url="'+ attrs.defaultattr+'" href="'+ attrs.defaultattr+'" class="popup">'+content+'</a>';}});$.sceditor.plugins.bbcode.bbcode.set("sqr",{allowsEmpty:true,tags:{span:{'data-square-value':null}},format:function(element,content){if(!(element.attr('data-square-value')))
return content;return'[sqr]'+ element.attr('data-square-value')+'[/sqr]';},html:'<span class="square" data-square-value="{0}" >√<span class="sqr">&nbsp;{0}</span></span>&nbsp;'});$.sceditor.plugins.bbcode.bbcode.set("size",{tags:{font:{size:null}},styles:{"font-size":null},format:function(element,content){var fontSize=element.attr('size'),size=2;if(!fontSize)
fontSize=element.css('fontSize');if(fontSize.indexOf("px")>-1){fontSize=fontSize.replace("px","")- 0;if(fontSize>12)
size=2;if(fontSize>15)
size=3;if(fontSize>17)
size=4;if(fontSize>23)
size=5;if(fontSize>31)
size=6;if(fontSize>47)
size=7;}else
size=fontSize;if(fontSize>4){size=4;}
if(fontSize<1){size=1;}
if(fontSize==2){return content;}
return'[size='+ size+']'+ content+'[/size]';},html:function(token,attrs,content){return'<font size="'+ attrs.defaultattr+'">'+ content+'</font>';}});$.sceditor.plugins.bbcode.bbcode.set("color",{tags:{font:{color:null}},styles:{color:null},quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function($element,content){var color,element=$element[0];if(element.nodeName.toLowerCase()!=='font'||!(color=$element.attr('color')))
color=element.style.color||$element.css('color');if(color=='#000000'||color=='#000'||color=='black'||color=='rgb(0, 0, 0)')
return content;return'[color='+ $.sceditor.plugins.bbcode.normaliseColour(color)+']'+ content+'[/color]';},html:function(token,attrs,content){return'<font color="'+ $.sceditor.plugins.bbcode.normaliseColour(attrs.defaultattr)+'">'+ content+'</font>';}});$.sceditor.plugins.bbcode.bbcode.set("ul",{tags:{ul:null},breakStart:false,isInline:false,skipLastLineBreak:true,format:"[ul]{0}[/ul]",html:'<ul>{0}</ul>'});$.sceditor.plugins.bbcode.bbcode.set("ol",{tags:{ol:null},breakStart:false,isInline:false,skipLastLineBreak:true,format:"[ol]{0}[/ol]",html:'<ol>{0}</ol>'});$.sceditor.plugins.bbcode.bbcode.set("li",{tags:{li:null},breakAfter:false,isInline:false,closedBy:['/ul','/ol','/list','*','li'],format:"[li]{0}[/li]",html:'<li>{0}</li>'});$.sceditor.plugins.bbcode.bbcode.set("table",{tags:{table:null},isInline:false,isHtmlInline:true,skipLastLineBreak:false,format:"[table]{0}[/table]",html:'<table class="bbcodeTable">{0}</table>'});$.sceditor.plugins.bbcode.bbcode.set("tr",{tags:{tr:null},breakAfter:false,isInline:false,skipLastLineBreak:true,format:"[tr]{0}[/tr]",html:'<tr>{0}</tr>'});$.sceditor.plugins.bbcode.bbcode.set("th",{tags:{th:null},breakAfter:false,allowsEmpty:true,isInline:false,format:"[th]{0}[/th]",html:'<th>{0}</th>'});$.sceditor.plugins.bbcode.bbcode.set("td",{tags:{td:null},breakAfter:false,allowsEmpty:true,isInline:false,format:"[td]{0}[/td]",html:'<td>{0}</td>'});var show_over_char_alert=0;$.sceditor.plugins.charlimit=function(){var base=this;base.signalReady=function(e){var value=$('#'+ this.opts.id.replace('editor_','')).data('sceditor').val();var text=value.replace(/\[\/?(?:b|i|u|s|sub|sup|left|right|center|justify|font|ul|li|ol|table|tr|td|hr|email|quote|yt|vimeo|rtl|ltr|url|quote|code|img|color|size|sqr|cmdoc|cmimg)*?.*?\]/img,'');var numOfCharacters=text.length;if(isNaN(this.opts.characterLimit)){this.opts.characterLimit=150;}
var remainingCharacters=this.opts.characterLimit- numOfCharacters;var editorCountId=this.opts.id+'_count';if(remainingCharacters>0){$('#'+ this.opts.id).append('<div class="sceditorCharacterCount"><p>Character Limit <span>'+remainingCharacters+'</span>/'+this.opts.characterLimit+'<p></div>');}else{$('#'+ this.opts.id).append('<div class="sceditorCharacterCount"><p>Character Limit <span class="red">'+remainingCharacters+'</span>/'+this.opts.characterLimit+'<p></div>');}},base.signalKeyupEvent=function(e){$('#'+ this.opts.id.replace('editor_','')).data('sceditor').updateOriginal();},base.signalKeydownEvent=function(e){var value=$('#'+ this.opts.id.replace('editor_','')).data('sceditor').val();var text=value.replace(/\[\/?(?:b|i|u|s|sub|sup|left|right|center|justify|font|ul|li|ol|table|tr|td|hr|email|quote|yt|vimeo|rtl|ltr|url|quote|code|img|color|size|sqr)*?.*?\]/img,'');var numOfCharacters=text.length;if(isNaN(this.opts.characterLimit)){this.opts.characterLimit=150;}
var remainingCharacters=(this.opts.characterLimit- numOfCharacters)-1;var editorCountId=this.opts.id+'_count';if(remainingCharacters>0){$('#'+ this.opts.id+' .sceditorCharacterCount p span').html(remainingCharacters);$('#'+ this.opts.id+' .sceditorCharacterCount span').removeClass('red bold');}else{if(show_over_char_alert==0){alert('You have exceeded the allowed character limit.\n\nYour text will be truncated to '+ this.opts.characterLimit+' characters when saved.');show_over_char_alert=1;}
$('#'+ this.opts.id+' .sceditorCharacterCount span').html(remainingCharacters);$('#'+ this.opts.id+' .sceditorCharacterCount span').addClass('red bold');}}};$('textarea.fullBBcodeEditor').attr('rows',3);$('textarea.fullBBcodeEditor').each(function(){var displayCountValue=false;var characterLimit=0;var pluginsValue='bbcode';if(typeof($(this).attr('data-charLimit'))!='undefined'){displayCountValue=true;characterLimit=$(this).attr('data-charLimit');pluginsValue='bbcode, charlimit';}
$('#'+ this.id).sceditor({id:'editor_'+ this.id,plugins:pluginsValue,autoExpand:true,toolbar:"bold,italic,underline,strike,color,size|orderedlist,bulletlist,table|link,yt|superscript,subscript,square,pastetext",style:BBCODE_CSS,resizeEnabled:true,displayCount:displayCountValue,characterLimit:characterLimit,disablePasting:false,enablePasteFiltering:true,emoticonsEnabled:false});});$('textarea.simpleBBcodeEditor').attr('rows',5);$('textarea.simpleBBcodeEditor').each(function(){var displayCountValue=false;var characterLimit=0;var pluginsValue='bbcode';if(typeof($(this).attr('data-charLimit'))!='undefined'){displayCountValue=true;characterLimit=$(this).attr('data-charLimit');pluginsValue='bbcode, charlimit';}
$('#'+ this.id).sceditor({id:'editor_'+ this.id,plugins:pluginsValue,autoExpand:false,toolbar:"bold,italic,underline,color,link,pastetext",style:BBCODE_CSS,resizeEnabled:false,displayCount:displayCountValue,characterLimit:characterLimit,disablePasting:false,enablePasteFiltering:true,emoticonsEnabled:false});});var loadCSS=function(url,callback){var link=document.createElement('link');link.type='text/css';link.rel='stylesheet';link.href=url;link.id='theme-style';document.getElementsByTagName('head')[0].appendChild(link);var img=document.createElement('img');img.onerror=function(){if(callback)callback(link);}
img.src=url;}});function colorText(){var input=$('.color-text');if((input.val().charAt(0)==='#'&&(input.val().length===4||input.val().length===7))||input.val().charAt(0)!=='#'&&input.val().length>=3){$('.show-color').show();$('.color-click').show();$('.sceditor-color-option-custom').css('background-color',input.val());$('.sceditor-color-option-custom').attr('data-color',input.val());}
else{$('.show-color').hide();$('.color-click').hide();}}
function youtubeIdExtract(youtube_id){if(youtube_id.indexOf("youtube.com/embed/")!=-1){alert('Do not add Embed code. Instead copy the YouTube Video ID or Link for the video to use.');return;}else if(youtube_id.indexOf("vimeo")!=-1){alert('This is a Vimeo video link. Select the Vimeo tab for this video.');return;}else if(youtube_id.indexOf("youtube")!=-1){youtube_id=youtube_id.replace(/^[^v]+v.(.{11}).*/,"$1");}else if(youtube_id.indexOf("youtu.be")!=-1){youtube_id=youtube_id.replace(/http(s?):\/\/youtu\.be\//,"").substring(0,11);}
if(youtube_id.length==11){return youtube_id;}
else{alert('Video ID must be 11 characters long');return;}}
function vimeoIdExtract(vimeoVideo){if(vimeoVideo.indexOf("youtube")!=-1||vimeoVideo.indexOf("youtu.be")!=-1){alert('This is a YouTube video link. Select the YouTube tab for this video.');return;}else if(vimeoVideo.indexOf("iframe")!=-1){alert('Do not add Embed code');return;}else if(vimeoVideo.length==0||vimeoVideo.indexOf("vimeo.com")==-1){alert('This is not a valid Vimeo Link. Please check the link and try again.');return false;}
var url=vimeoVideo;var regExp=/http(s)?:\/\/(www\.)?(player\.)?vimeo.com\/(video\/)?(\d+)($|\/)/;var match=url.match(regExp);if(!match){alert("This is not a valid Vimeo Link. Please check the link and try again.");return;}
var vimeo_video_id=match[5];return vimeo_video_id;}